## Learn Infrastructure as Code

### Day56

#### ğŸ“Œ IaC

1. ë°ë¸Œì˜µìŠ¤ ì´ì „

ğŸ”»ìƒˆë¡œìš´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹Œë“œí•˜ëŠ” ê²½ìš° ëŒ€ë¶€ë¶„ì˜ ì„œë²„ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì¤€ë¹„í•´ì•¼í–ˆìŒ

> ê°€ìƒë¨¸ì‹  ë°°í¬ / ë¬¼ë¦¬ì  ì„œë²„ ë° ìš´ì˜ ì²´ì œ ì„¤ì¹˜

> ë„¤íŠ¸ì›Œí‚¹ êµ¬ì„±

> ë¼ìš°íŒ… í…Œì´ë¸” ìƒì„±

> ì†Œí”„íŠ¸ì›¨ì–´ ë° ì—…ë°ì´íŠ¸ ì„¤ì¹˜

> ì†Œí”„íŠ¸ì›¨ì–´ êµ¬ì„±

> ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜

ğŸ”» ìœ„ì˜ ì´ˆê¸° ë‹¨ê³„ ì´ì™¸ì— ì„œë²„ë¥¼ ìœ ì§€ ê´€ë¦¬í•´ì•¼í–ˆìŒ

> ë²„ì „ ì—…ë°ì´íŠ¸

> ìƒˆ ë¦´ë¦¬ì¦ˆ ë°°í¬

> ë°ì´í„° ê´€ë¦¬

> ì• í”Œë¦¬ì¼€ì´ì…˜ ë³µêµ¬

> ì„œë²„ ì¶”ê°€, ì œê±° ë° í™•ì¥

> ë„¤íŠ¸ì›Œí¬ êµ¬ì„±

ğŸ”» í…ŒìŠ¤íŠ¸ ë° ê°œë°œ í™˜ê²½ì˜ ë³µì¡ì„± ì¶”ê°€

2. IaC

âœ”ï¸ IaCë¥¼ ì‚¬ìš©í•˜ë©´ ìœ„ì˜ ëª¨ë“  ì‘ì—…ì„ ì²˜ìŒë¶€í„° ëê¹Œì§€ <span style="color:indianred">ìë™í™”</span> ê°€ëŠ¥

**IaC**

1. ë¬¼ë¦¬ë¨¸ì‹ , ê°€ìƒë¨¸ì‹ , í´ë¼ìš°ë“œ VM, í´ë¼ìš°ë“œ PaaS ë“±ì˜ ì‹œìŠ¤í…œì„ ìƒì„ ê²½ìš° ì „ì²´ í™˜ê²½ì„ ì¬êµ¬ì¶•í•˜ëŠ”ë° ë„ì›€ì´ ë¨

2. ì¸í”„ë¼ë¥¼ ìë™ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹í•˜ëŠ” ê°œë…ìœ¼ë¡œ, ì„œë²„ì— ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì„œë²„ë¥¼ íê¸°í•˜ê³  ìƒˆ ì„œë²„ë¥¼ ìŠ¤í•€ì—…í•˜ëŠ” ì‘ì—… ìˆ˜í–‰í•˜ëŠ” ë“± ì½”ë“œì— ì •ì˜ëœ ëŒ€ë¡œ ì •í™•í•˜ê²Œ ì‘ë™

#### ğŸ“Œ ì¸í”„ë¼ í”„ë¡œë¹„ì €ë‹

**Terraform**

ì¸í”„ë¼ì˜ ëª¨ì–‘ì„ ì½”ë“œë¡œ ì •ì˜í•œ ë‹¤ìŒ ë°°í¬í•  ìˆ˜ ìˆìœ¼ë©°, ì¸í”„ë¼ë¥¼ ê´€ë¦¬í•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì²˜ìŒ ë°°í¬í•  ìˆ˜ ìˆì§€ë§Œ ê·¸ ì‹œì ì—ì„œëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¶”ì í•  ìˆ˜ ì—†ìŒ

=> ë”°ë¼ì„œ Terraformë³´ë‹¤ Ansibleê³¼ ê°™ì€ ë„êµ¬ê°€ ë” ì˜ ì‘ë™í•  ìˆ˜ ìˆìŒ

ì†Œí”„íŠ¸ì›¨ì–´ ì´ˆê¸° ì„¤ì¹˜ ë° êµ¬ì„±

âœ”ï¸ ìƒˆ ì„œë²„ ìŠ¤í•€ì—…

âœ”ï¸ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±

âœ”ï¸ ë¡œë“œ ë°¸ëŸ°ì„œ ìƒì„±

âœ”ï¸ ì¸í”„ë¼ ìˆ˜ì¤€ì—ì„œ êµ¬ì„±

#### ğŸ“Œ í”„ë¡œë¹„ì €ë‹ëœ ì¸í”„ë¼ êµ¬ì„±

- ì„œë²„ì— ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì¹˜

- ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•  ì„œë²„ ì¤€ë¹„

#### ğŸ“Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬

- ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ë° ê´€ë¦¬

- ìœ ì§€ ê´€ë¦¬ ë‹¨ê³„

- ì†Œí”„íŠ¸ì›¨ì–´ ì—…ë°ì´íŠ¸

- ì¬êµ¬ì„±

#### ğŸ“Œ IaC ë„êµ¬ì˜ ì°¨ì´ì 

1. ì„ ì–¸ì  ë°©ì‹ê³¼ ì ˆì°¨ì  ë°©ì‹

1) ì„ ì–¸ì  ë°©ì‹

- ê²°ê³¼ ì„ ì–¸: ì›í•˜ëŠ” ì‹œìŠ¤í…œ ìƒíƒœì™€ ë¦¬ì†ŒìŠ¤ ì •ì˜

- ì„œë²„ 2ê°œ

2. ì ˆì°¨ì  ë°©ì‹

- ë‹¨ê³„ë³„ ì§€ì¹¨: íŠ¹ì • êµ¬ì„±ì„ ë‹¬ì„±í•˜ëŠ”ë° í•„ìš”í•œ ëª…ë ¹ ì •ì˜

- ì„œë²„ ìƒì„± > ì„œë²„ ì¶”ê°€ > ë³€ê²½

2. ë³€ê²½ ê°€ëŠ¥(ë°˜ë ¤ë™ë¬¼) vs ë³€ê²½ ë¶ˆê°€ (ê°€ì¶•)

1) ë³€ê²½ ê°€ëŠ¥

- ëŒ€ì²´ ëŒ€ì‹  ë³€ê²½

- ì¼ë°˜ì ìœ¼ë¡œ ìˆ˜ëª…ì´ ê¹€

- But ê° ì„œë²„ì™€ ëª¨ë“  ìŠ¤ìœ„ì¹˜ë¥¼ ê°œë³„ì ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼í•˜ê¸°ì— ë¬¸ì œ ì‹ë³„ ë° ì†”ë£¨ì…˜ ìƒì„±ì— ì˜¤ëœ ì‹œê°„ ì†Œìš”ë¨

2. ë³€ê²½ ë¶ˆê°€

- ë³€ê²½ ëŒ€ì‹  êµì²´

- ìˆ˜ëª…ì´ ì§§ì„ ìˆ˜ ìˆìŒ

- But ì¸í”„ë¼ì˜ ì¼ê´€ì„±ì„ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í›¨ì”¬ ë” ë¹ ë¥´ê³  ì•ˆì •ì ìœ¼ë¡œ êµ¬ì¶•í•˜ê³  ë°°í¬ ê°€ëŠ¥

ğŸ“¢ ìš”ì•½í•˜ë©´, <span style="color:indianred">IaC(Infrastructure)</span> ë¼ëŠ” ì„œë²„ë¥¼ ìë™í™”ì‹œí‚¤ëŠ” ê°œë…ì´ ë°œìƒí•˜ê³  ê·¸ ë„êµ¬ì˜ ì˜ˆì‹œê°€ <span style="color:indianred">Terraform</span>. í”„ë¡œë¹„ì €ë‹ì´ë€ IT ì¸í”„ë¼ë¥¼ ìƒì„±í•˜ê³  ì„¤ì •í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¡œ, ë°°í¬í•˜ëŠ” ê³¼ì •ì—ì„œ ì´ˆê¸° ë‹¨ê³„

ğŸ“¢ IaCì—ì„œëŠ” ë„¤íŠ¸ì›Œí¬, ê°€ìƒë¨¸ì‹ , ë¡œë“œë°¸ëŸ°ì„œ, ì—°ê²° í† í´ë¡œì§€ê°€ ì½”ë”©ë˜ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì— ì‚¬ìš©ë˜ëŠ” í™˜ê²½ì„ í‘œì¤€í™”í•˜ë©°, DevOpsëŠ” ì½”ë”©ë˜ë©´ ë³€í™”í•˜ëŠ” ìˆ˜ìš”ì— ë§ì¶° ì¸í”„ë¼ë¥¼ ë¹ ë¥´ê²Œ ì‹œì‘í•˜ê³  í•´ì²´í•˜ë©° ì¡°ì •í•  ìˆ˜ ìˆì–´ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ë° í…ŒìŠ¤íŠ¸, êµ¬í˜„ì´ ë¹ ë¥´ê³  ì‰¬ì›Œì§

### Day57

#### ğŸ“Œ Terraform ì†Œê°œ

1. Terraform

- ì¸í”„ë¼ë¥¼ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ êµ¬ì¶•, ë³€ê²½, ë²„ì „ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ë„êµ¬

- ìˆ˜ë°± ê°œì˜ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì¼ê´€ëœ CLI workflowë¥¼ ì œê³µí•˜ëŠ” ì½”ë“œ ì†Œí”„íŠ¸ì›¨ì–´ ë„êµ¬ì´ì ì˜¤í”ˆ ì†ŒìŠ¤ ì¸í”„ë¼. í´ë¼ìš°ë“œ APIë¥¼ `ì„ ì–¸ì  êµ¬ì„± íŒŒì¼`ë¡œ ì½”ë“œí™”

- ë³µì¡í•œ ì¸í”„ë¼ í™˜ê²½ì„ í”„ë¡œë¹„ì €ë‹í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” CLI. ë¡œì»¬ ë˜ëŠ” ì›ê²©(í´ë¼ìš°ë“œ)ì— ì¡´ì¬í•˜ëŠ” ë³µì¡í•œ ì¸í”„ë¼ ìš”êµ¬ ì‚¬í•­ì„ ì •ì˜í•  ìˆ˜ ìˆìŒ. ì²˜ìŒì— êµ¬ì¶•í•  ìˆ˜ ìˆì„ ë¿ë§Œ ì•„ë‹ˆë¼ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì˜ ìˆ˜ëª… ê¸°ê°„ë™ì•ˆ ìœ ì§€ ê´€ë¦¬ ë° ì—…ë°ì´íŠ¸ ê°€ëŠ¥

2. Terraform ê°œìš”

(1) Write

-> Terraformì„ ì‚¬ìš©í•˜ë©´ í™˜ê²½ì„ êµ¬ì¶•í•  ì„ ì–¸ì  êµ¬ì„± íŒŒì¼ ìƒì„± ê°€ëŠ¥

-> í•´ë‹¹ íŒŒì¼ì€ ë¸”ë¡œê·¸ ì¸ìˆ˜, í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ë¥¼ ê°„ê²°í•˜ê²Œ ì„¤ëª…í•  ìˆ˜ ìˆëŠ” <span style="color:indianred">í•´ì‹œì½”í”„ êµ¬ì„± ì–¸ì–´(HCL)</span>ì„ ì‚¬ìš©í•˜ì—¬ ì‘ì„±

(2) Plan

-> ìƒì„±í•œ êµ¬ì„± íŒŒì¼ì„ í™•ì¸í•˜ê¸° ìœ„í•´ Terraform cliì˜ íŠ¹ì • ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ë°°í¬í•˜ê±°ë‚˜ ë³€ê²½í•˜ê¸° ì „ì— í…ŒìŠ¤íŠ¸í•˜ëŠ” ê¸°ëŠ¥

-> Terraformì€ ì¸í”„ë¼ë¥¼ ìœ„í•œ ì§€ì†ì ì¸ ë„êµ¬ì´ê¸°ì— ì¸í”„ë¼ë¥¼ ë³€ê²½í•˜ë ¤ë©´ í…Œë¼í¼ì„ í†µí•´ ì½”ë“œì— ë³€ê²½ ì‚¬í•­ì´ ì¡´ì¬í•˜ë„ë¡ í•´ì•¼í•¨

(3) Apply

-> Terraform ë‚´ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ providerì— ì´ êµ¬ì„±ì„ ì ìš©í•  ìˆ˜ ìˆìŒ

ex. AWS, Azure, Google Cloud Platform, Kubernetes, Alibaba Cloud, Oracle Cloud Infrastructure

-> Terraformì—ì„œ ì‚¬ìš©ê°€ëŠ¥í•œ ëª¨ë“ˆì´ ì¡´ì¬í•˜ê³  ê³µê°œì ìœ¼ë¡œ ìƒì„± ë° ê³µìœ ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ìƒˆë¡œ ë§Œë“¤ í•„ìš”ì—†ì´ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•˜ë©´ ë¨

3. Terraform workflow

![](image.png)

4. Terraform vs Vagrant

- Terraformê³¼ Vagrant í•´ì‹œì½”í”„ ì˜¤í”ˆì†Œìˆ˜ ë„êµ¬

âœ”ï¸ Terraform : ì¸í”„ë¼ êµ¬ì¶•ì„ ìœ„í•œ ë„êµ¬

âœ”ï¸ Vagrant : ê°œë°œ í™˜ê²½ ê´€ë¦¬ì— ì¤‘ì ì„ ë‘” ë„êµ¬

#### ğŸ“Œ Terraform ì„¤ì¹˜

- Terraformì€ cross-platformì´ë¯€ë¡œ ì•„ë˜ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì½”ë“œ ì‘ì„±ì„ í†µí•´ ì„¤ì¹˜ ê°€ëŠ¥

https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli

- arkade(í•„ìš”í•œ ë„êµ¬, ì•±, í´ë¦¬ìŠ¤ë¥¼ ì‹œìŠ¤í…œì— ì„¤ì¹˜í•  ìˆ˜ ìˆëŠ” ë„êµ¬)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¤ì¹˜ê°€ ê°€ëŠ¥í•œë° `arkade get terraform` ëª…ë ¹ì–´ë¥¼ í†µí•´ í…Œë¼í¼ ì—…ë°ì´íŠ¸ ê°€ëŠ¥

### Day58

#### ğŸ“Œ HashiCorp êµ¬ì„± ì–¸ì–´ (HCL)

- ì¼ë°˜ì ìœ¼ë¡œ Terraformì—ì„œ ì‚¬ìš©í•˜ëŠ” ì¸í”„ë¼ í”Œë«í¼ì€ ì•„ë‹ˆì§€ë§Œ ë³¸ ì‹¤ìŠµì—ì„œëŠ” VirtualBox ì‚¬ìš©í•  ê²ƒ

- ì¼ë°˜ì ìœ¼ë¡œ í¼ë¸”ë¦­ í´ë¼ìš°ë“œ(AWS, Google Microsoft Azure) ë¿ë§Œ ì•„ë‹ˆë¼ ê°€ìƒí™” í™˜ê²½(VMware, Microsoft Hyper-V, Nutanix AHV)ì—ë„ ì¸í”„ë¼ë¥¼ ë°°í¬í•˜ëŠ”ë° Terraform ì‚¬ìš©

- Terraformì—ëŠ” `code`ì™€ `state`ë¼ëŠ” ë‘ ê°€ì§€ í•µì‹¬ ì¡´ì¬ + ë°°í¬í•˜ê³ ìí•˜ëŠ” í™˜ê²½ì¸ `Terraform ê³µê¸‰ì` (AWS ê³µê¸‰ì, Azure ê³µê¸‰ì ë“±ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰)

â­ï¸ ê¸°ë³¸ Terraform ì‚¬ìš©ë²•

âœ”ï¸ `.tf` íŒŒì¼ì´ ì–´ë–»ê²Œ êµ¬ì„±ë˜ëŠ”ì§€ í™•ì¸

âœ”ï¸ ì˜ˆì œ: <span style="color:indianred">AWSì— ë¦¬ì†ŒìŠ¤ë¥¼ ë°°í¬</span>í•˜ëŠ” ì½”ë“œ => ì‹œìŠ¤í…œì— AWS CLI ì„¤ì¹˜í•˜ê³  ê³„ì •ì— ë§ê²Œ êµ¬ì„±

1. ê³µê¸‰ì

âœ”ï¸ `.tf` íŒŒì¼ êµ¬ì¡°ì˜ ìµœìƒë‹¨ì—ëŠ” `main.tf`ë¼ ë¶ˆë¦¬ëŠ” íŒŒì¼ ì¡´ì¬. í•´ë‹¹ íŒŒì¼ì—ì„œ ê³µê¸‰ì ì •ì˜

=> AWS ê³µê¸‰ì ì†ŒìŠ¤ëŠ” `hashicorp/aws`ì´ë©° ì´ëŠ” ê³µê¸‰ìê°€ HashiCorpì—ì„œ ì§ì ‘ ìœ ì§€ ê´€ë¦¬í•˜ê±°ë‚˜ ê²Œì‹œí–ˆìŒì„ ì˜ë¯¸

```
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 3.0"
    }
  }
}
```

âœ”ï¸ ê¸°ë³¸ì ìœ¼ë¡œ Terraform ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì œê³µì(https://registry.terraform.io/)ë¥¼ ì°¸ì¡°í•˜ê²Œ ë˜ë©°, ì œê³µìë¥¼ ì‘ì„±í•˜ì—¬ ë¡œì»¬ì—ì„œ ì‚¬ìš©í•˜ê±°ë‚˜ Terraform ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ìì²´ ê²Œì‹œí•  ìˆ˜ ìˆìŒ

âœ”ï¸ í”„ë¡œë¹„ì €ë‹í•  AWSì˜ regionì„ ê²°ì •í•˜ê¸° ìœ„í•´ ì¶”ê°€ ê°€ëŠ¥

```
provider "aws" {
  region = "ap-southeast-1" //ë¦¬ì†ŒìŠ¤ë¥¼ ë°°í¬í•´ì•¼ í•˜ëŠ” ì§€ì—­
}
```

2. Terraform resource

âœ”ï¸ EC2, ë¡œë“œë°¸ëŸ°ì„œ, VPC ë“±ê³¼ ê°™ì€ í•˜ë‚˜ ì´ìƒì˜ ì¸í”„ë¼ ê°œì²´ë¥¼ ì„¤ëª…í•˜ëŠ” Terraform êµ¬ì„± íŒŒì¼ì˜ êµ¬ì„±ìš”ì†Œ

âœ”ï¸ resource ë¸”ë¡ì€ ì§€ì •ëœ ìœ í˜•("aws_instance")ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì§€ì •ëœ ë¡œì»¬ ì´ë¦„("90daysofdevops")ìœ¼ë¡œ ì„ ì–¸

âœ”ï¸ resource ìœ í˜•ê³¼ ì´ë¦„ì€ í•¨ê»˜ ì§€ì •ëœ resourceì˜ ì‹ë³„ì ì—­í• 

âœ”ï¸ `yum` ì—…ë°ì´íŠ¸ ì‹¤í–‰ + ec2 ì¸ìŠ¤í„´ìŠ¤ì— `httpd`(ì˜¤í”ˆ ì†ŒìŠ¤ ê¸°ë°˜ ì›¹ ì„œë²„) ì„¤ì¹˜

```
resource "aws_instance" "90daysofdevops" {
  ami               = data.aws_ami.instance_id.id
  instance_type     = "t2.micro"
  availability_zone = "us-west-2a"
  security_groups   = [aws_security_group.allow_web.name]
  user_data         = <<-EOF
                #! /bin/bash
                sudo yum update
                sudo yum install -y httpd
                sudo systemctl start httpd
                sudo systemctl enable httpd
                echo "
<h1>Deployed via Terraform</h1>

" | sudo tee /var/www/html/index.html
        EOF
  tags = {
    Name = "Created by Terraform"
  }
}
```

âœ”ï¸ ì „ì²´ `main.tf`

=> ì•„ë˜ ì½”ë“œ ì„¤ëª…) AWSì—ì„œ ì›¹ ì„œë²„ë¥¼ EC2 ì¸ìŠ¤í„´ìŠ¤ë¡œ ë°°í¬

```
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 3.27"
    }
  }

  required_version = ">= 0.14.9"
}

provider "aws" {
  profile = "default"
  region  = "us-west-2"
}

resource "aws_instance" "90daysofdevops" {
  ami           = "ami-830c94e3"
  instance_type = "t2.micro"
  availability_zone = "us-west-2a"
    user_data         = <<-EOF
                #! /bin/bash
                sudo yum update
                sudo yum install -y httpd
                sudo systemctl start httpd
                sudo systemctl enable httpd
                echo "
<h1>Deployed via Terraform</h1>

" | sudo tee /var/www/html/index.html
        EOF
  tags = {
    Name = "Created by Terraform"

  tags = {
    Name = "ExampleAppServerInstance"
  }
}
```

âœ”ï¸ ë‹¤ë¥¸ ì˜ˆì œ: Terraform ëª¨ë“ˆ ì‚¬ìš©

```
terraform {
  # ì´ ëª¨ë“ˆì€ í˜„ì¬ Terraform 0.13.xì—ì„œë§Œ í…ŒìŠ¤íŠ¸ ì¤‘ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë” ì‰½ê²Œ ì—…ê·¸ë ˆì´ë“œí•  ìˆ˜ ìˆë„ë¡ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤.
  # 0.12.26ì„ ìµœì†Œ ë²„ì „ìœ¼ë¡œ ì„¤ì •í–ˆëŠ”ë°, ì´ ë²„ì „ì€ ì†ŒìŠ¤ URLì´ ìˆëŠ” required_providersì— ëŒ€í•œ ì§€ì›ì´ ì¶”ê°€ë˜ì—ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
  # 0.13.x ì½”ë“œì™€ í˜¸í™˜ë©ë‹ˆë‹¤.
  required_version = ">= 0.12.26"
}

# website::tag::1:: ê°€ì¥ ê°„ë‹¨í•œ Terraform ëª¨ë“ˆ: "Hello, World!"ë¥¼ ì¶œë ¥í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.
output "hello_world" {
  value = "Hello, 90DaysOfDevOps from Terraform"
}
```

- í•´ë‹¹ íŒŒì¼ì„ IaC í´ë” ì•ˆì˜ Hello-world í´ë”ì—ì„œ ì°¾ì„ ìˆ˜ ìˆì§€ë§Œ Terraform ì½”ë“œë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì‹¤í–‰í•´ì•¼í•˜ëŠ” ê³¼ì •ì´ ìˆê¸°ì— ë°”ë¡œ ì‘ë™í•˜ì§€ ì•ŠìŒ

âœ”ï¸ Terraform ëª¨ë“ˆ ì‚¬ìš©í•˜ê¸° ì „ Terraform ì½”ë“œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì‹¤í–‰í•´ì•¼í•˜ëŠ” ê³¼ì •

1. í„°ë¯¸ë„ì—ì„œ main.tfê°€ ìƒì„±ëœ í´ë”ë¡œ ì´ë™ -> í•´ë‹¹ í´ë”ì—ì„œ `terraform init` ì‹¤í–‰

- terraform ì½”ë“œê°€ ìˆëŠ” ëª¨ë“  ë””ë ‰í† ë¦¬ì—ì„œ ë˜ëŠ” terraform ì½”ë“œ ì‹¤í–‰í•˜ê¸° ì „ í•´ë‹¹ ì‘ì—… ìˆ˜í–‰í•´ì•¼ë§Œ í•¨. êµ¬ì„± ë””ë ‰í† ë¦¬ë¥¼ ì´ˆê¸°í™”í•˜ë©´ êµ¬ì„±ì— ì •ì˜ëœ ê³µê¸‰ìë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì„¤ì¹˜ (ì•„ë˜ì˜ ëª¨ë“ˆ ì‚¬ìš© ì˜ˆì œì—ëŠ” ê³µê¸‰ìê°€ ì—†ì§€ë§Œ ìœ„ì˜ ì˜ˆì œì—ëŠ” AWS ê³µê¸‰ì ë‹¤ìš´ë¡œë“œí•´ì•¼í•¨)

- ë³¸ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ë•Œ í´ë” íŠ¸ë¦¬ë¥¼ ì „í›„ë¡œ ì‚´í´ë³´ê³  ì–´ë–¤ ì¼ì´ ë°œìƒí•˜ê³  ì œê³µìì™€ ëª¨ë“ˆì„ ì–´ë””ì— ì €ì¥í•˜ëŠ”ì§€ í™•ì¸

2. `terraform plan`

- ì‹¤í–‰ ê³„íšì„ ìƒì„±í•˜ì—¬ Terraformì´ ì¸í”„ë¼ì— ì ìš©í•˜ë ¤ëŠ” ë³€ê²½ ì‚¬í•­ì„ ë¯¸ë¦¬ ë³¼ ìˆ˜ ìˆê²Œ í•´ì¤Œ

- í˜„ì¬ ì‹œì ì—ì„œ ë¦¬í¬ì§€í† ë¦¬ ì´ˆê¸°í™”ë¥¼ ì™„ë£Œí•˜ê³  í•„ìš”í•œ ê²½ìš° ì œê³µìë¥¼ ë‹¤ìš´ë¡œë“œí–ˆìœ¼ë©° í…ŒìŠ¤íŠ¸ ì›Œí¬ìŠ¤ë£¨ë¥¼ ì‹¤í–‰í•˜ì—¬ ì›í•˜ëŠ”ëŒ€ë¡œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸ => ì½”ë“œ ì‹¤í–‰ ë° ë°°í¬ ê°€ëŠ¥

3. `terraform apply`

- ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìœ¼ë©°, í•´ë‹¹ ëª…ë ¹ì—ëŠ” ì•ˆì „ ì¡°ì¹˜ê°€ ë‚´ì¥ë˜ì–´ ìˆì–´ ì•ìœ¼ë¡œ ì¼ì–´ë‚  ì¼ì— ëŒ€í•œ ê³„íš ë³´ê¸°ê°€ ì œê³µë˜ë¯€ë¡œ ê³„ì†í•  ê²ƒì¸ì§€ì— ëŒ€í•œ ì‘ë‹µ ë³´ì¥

- Enter a valueì— yesë¥¼ ì…ë ¥í•˜ë©´ ì½”ë“œê°€ ë°°í¬ë˜ë©° ì½”ë“œì—ì„œ ì •ì˜í•œ ì¶œë ¥ì´ ë‚˜íƒ€ë‚¨

4. `terraform destroy`

- ë¬´ì–¸ê°€ë¥¼ ë°°í¬í•œ í›„ ë°°í¬í•œ ëª¨ë“  ê²ƒì„ ì œê±°í•  ê²½ìš° ì‚¬ìš©

ğŸ”¥ Terraform CLI

- `terraform init` : í”„ë¡œë°”ì´ë”ë¡œ í”„ë¡œì íŠ¸ í´ë” ì¤€ë¹„

- `terraform plan` : ì½”ë“œ ê¸°ë°˜ìœ¼ë¡œ ëª…ë ¹ ì¤‘ ìƒì„± ë° ë³€ê²½ë  ë‚´ìš© í‘œì‹œ

- `terraform apply` : ì½”ë“œì— ì •ì˜ëœ ë¦¬ì†ŒìŠ¤ ë°°í¬

- `terraform destroy` : í”„ë¡œì íŠ¸ì—ì„œ ìƒì„±í•œ ë¦¬ì†ŒìŠ¤ íŒŒê´´

ğŸ”¥ ì½”ë“œ íŒŒì¼ì—ì„œ ì¤‘ìš”í•œ ì¸¡ë©´

- `providers` : APIë¥¼ í†µí•´ Terraformì´ ìµœì¢… í”Œë«í¼ê³¼ ëŒ€í™”í•˜ëŠ” ë°©ë²•

- `resources` : ìš°ë¦¬ê°€ ì½”ë“œë¡œ ë°°í¬í•˜ê³ ì í•˜ëŠ” ê²ƒ

3. Terraform state

âœ”ï¸ ë””ë ‰í† ë¦¬ ë‚´ë¶€ì— ìƒì„±ë˜ëŠ” terraform ìƒíƒœë¥¼ í‘œí˜„í•˜ëŠ” JSON íŒŒì¼

âœ”ï¸ ë¯¼ê°í•œ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ GitHubì— ì—…ë¡œë“œí•˜ê¸° ì „ .tfstate íŒŒì¼ì„ .gitignore í´ë”ì— ë„£ëŠ” ê²ƒì´ ì¢‹ìŒ

```
{
  "version": 4,
  "terraform_version": "1.1.6",
  "serial": 1,
  "lineage": "a74296e7-670d-0cbb-a048-f332696ca850",
  "outputs": {
    "hello_world": {
      "value": "Hello, 90DaysOfDevOps from Terraform",
      "type": "string"
    }
  },
  "resources": []
}
```

âœ”ï¸ ê¸°ë³¸ì ìœ¼ë¡œ ìƒíƒœ íŒŒì¼ì€ í”„ë¡œì íŠ¸ ì½”ë“œì™€ ê°™ì€ ë””ë ‰í† ë¦¬ì— ì¡´ì¬í•˜ì§€ë§Œ ì˜µì…˜ìœ¼ë¡œ ì›ê²©ìœ¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆìœ¼ë©°, ë‹¤ë¥¸ ì˜µì…˜ìœ¼ë¡œëŠ” ìœ ë£Œ ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ì¸ Terraform Cloud ì¡´ì¬

- ì›ê²© ìœ„ì¹˜ì— ìƒíƒœë¥¼ ì €ì¥í•˜ëŠ” ê²½ìš°ì˜ ì¥ì : ë¯¼ê°í•œ ë°ì´í„° ì•”í˜¸í™” / í˜‘ì—… / ìë™í™”

- ë‹¨ì : ë³µì¡ì„± ì¦ê°€

### Day59

#### ğŸ“Œ Terraform ë° ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ VM ìƒì„±

- VirtualBoxì—ì„œ Terraformì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì¢‹ì€ ì˜ˆì‹œê°€ ì•„ë‹ˆì§€ë§Œ ë°ëª¨ ëª©ì ì´ë¯€ë¡œ ì§„í–‰

- VirtualBox ë‚´ì—ì„œ Terraformì„ ì‚¬ìš©í•˜ì—¬ VM ìƒì„±: ì›í•˜ëŠ” ìƒíƒœ êµ¬ì„± ì½”ë“œë¥¼ ë§Œë“  ë‹¤ìŒ VirtualBox ê³µê¸‰ìì— ëŒ€í•´ ì‹¤í–‰

1. VirtualBoxì—ì„œ ê°€ìƒ ë¨¸ì‹  ìƒì„±í•˜ê¸° (1)

- VirtualBoxë¼ëŠ” ìƒˆ í´ë” ìƒì„± + VirtualBox.tf íŒŒì¼ ìƒì„± + ë¦¬ì†ŒìŠ¤ ì •ì˜

- ì•„ë˜ ì½”ë“œë¥¼ í†µí•´ VirtualBoxì— 2ê°œì˜ VM ìƒì„±

ì°¸ê³  https://registry.terraform.io/providers/terra-farm/virtualbox/latest/docs/resources/vm

```
terraform {
  required_providers {
    virtualbox = {
      source = "terra-farm/virtualbox"
      version = "0.2.2-alpha.1"
    }
  }
}

# í˜„ì¬ ê³µê¸‰ì ìì²´ì— ëŒ€í•œ êµ¬ì„± ì˜µì…˜ì´ ì—†ìŠµë‹ˆë‹¤.

resource "virtualbox_vm" "node" {
  count     = 2
  name      = format("node-%02d", count.index + 1)
  image     = "https://app.vagrantup.com/ubuntu/boxes/bionic64/versions/20180903.0.0/providers/virtualbox.box"
  cpus      = 2
  memory    = "512 mib"

  network_adapter {
    type           = "hostonly"
    host_interface = "vboxnet1"
  }
}

output "IPAddr" {
  value = element(virtualbox_vm.node.*.network_adapter.0.ipv4_address, 1)
}

output "IPAddr_2" {
  value = element(virtualbox_vm.node.*.network_adapter.0.ipv4_address, 2)
}

```

2. VirtualBoxì—ì„œ ê°€ìƒ ë¨¸ì‹  ìƒì„±í•˜ê¸° (2)

- `terraform init`ì„ í†µí•´ VirtualBoxìš© ê³µê¸‰ì ë‹¤ìš´ë¡œë“œ

- ì´ë•Œ ì‹œìŠ¤í…œì—ë„ VirtualBoxê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•¨

3. VirtualBoxì—ì„œ ê°€ìƒ ë¨¸ì‹  ìƒì„±í•˜ê¸° (3)

- `terraform plan`ì„ í†µí•´ ì‹¤í–‰í•˜ì—¬ ì½”ë“œê°€ ë¬´ì—‡ì„ ìƒì„±í•˜ëŠ”ì§€ í™•ì¸

4. VirtualBoxì—ì„œ ê°€ìƒ ë¨¸ì‹  ìƒì„±í•˜ê¸° (4)

- `terraform apply`ë¥¼ í†µí•´ ì™„ì„±ëœ í”„ë¡œì„¸ìŠ¤ í‘œì‹œ

5. í™•ì¸

- VirtualBoxì—ì„œ 2ê°œì˜ ê°€ìƒë¨¸ì‹ ì´ ìƒì„±ëœ ê²ƒ í™•ì¸ ê°€ëŠ¥

6. êµ¬ì„± ë³€ê²½

- ë°°í¬ì— ë‹¤ë¥¸ ë…¸ë“œ ì¶”ê°€ í›„ `terraform apply` í•˜ë©´ VirtualBoxì—ì„œ 3ê°œì˜ ë…¸ë“œê°€ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŒ

7. ì‚­ì œ

- `terraform destroy`ë¥¼ í†µí•´ ë¨¸ì‹  ì œê±°

8. ë³€ìˆ˜ ë° ì¶œë ¥

- hello-world ì˜ˆì œ ì‹¤í–‰í•  ë•Œ ì–¸ê¸‰ëœ ì¶œë ¥ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë§ì€ ë³€ìˆ˜ ì¡´ì¬. ë³€ìˆ˜ ì •ì˜í•˜ëŠ” ë°©ë²•

âœ”ï¸ `terraform plan` ë˜ëŠ” `terraform apply` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•  ìˆ˜ ìˆìŒ

âœ”ï¸ ë¸”ë¡ ë‚´ì˜ .tf íŒŒì¼ì— ë³€ìˆ˜ ì •ì˜ ê°€ëŠ¥

âœ”ï¸ `TF_VAR_NAME` í˜•ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì‹œìŠ¤í…œ ë‚´ì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

âœ”ï¸ í”„ë¡œì íŠ¸ í´ë”ì— terraform.tfvars íŒŒì¼ ì‚¬ìš© ì„ í˜¸

âœ”ï¸ \*auto.tfvars íŒŒì¼ ì˜µì…˜

âœ”ï¸ `-var` ë˜ëŠ” `-var-file`ì„ ì‚¬ìš©í•˜ì—¬ `terraform plan` ë˜ëŠ” `terraform apply`ì„ ì‹¤í–‰í•  ë•Œ ì •ì˜ ê°€ëŠ¥

- state íŒŒì¼ì— í¬í•¨ë˜ëŠ” ë¯¼ê°í•œ ì •ë³´ë¥¼ ë³€ìˆ˜ë¡œ ì •ì˜í•  ìˆ˜ ìˆìŒ

```
variable "some resource"  {
    description = "something important"
    type= string
    sensitive = true

}
```

### Day60

- Day59ì—ì„œëŠ” Terraformì„ ì‚¬ìš©í•˜ì—¬ ë¡œì»¬ ë¬´ë£Œ VirtualBox í™˜ê²½ì— ê°€ìƒ ë¨¸ì‹ ì„ í”„ë¡œë¹„ì €ë‹. ë³¸ ì„¹ì…˜ì—ì„œëŠ” ëª‡ ê°€ì§€ êµ¬ì„±ì´ í¬í•¨ëœ Docker ì»¨í…Œì´ë„ˆë¥¼ ë¡œì»¬ Docker í™˜ê²½ì— ë°°í¬

#### ğŸ“Œ Docker ë°ëª¨

1. ì•„ë˜ ì½”ë“œë¥¼ í†µí•´ ê°„ë‹¨í•œ ì›¹ ì•±ì„ Dockerì— ë°°í¬í•˜ê³  ê²Œì‹œí•˜ì—¬ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•¨

- nginx ì‚¬ìš© + localhostì™€ í¬íŠ¸ 8000 ì‚¬ìš©

1. .tf íŒŒì¼ ìƒì„± ë° ë¦¬ì†ŒìŠ¤ ì •ì˜

```
terraform {
  required_providers {
    docker = {
      source  = "kreuzwerker/docker"
      version = "2.16.0"
    }
  }
}

provider "docker" {}

resource "docker_image" "nginx" {
  name         = "nginx:latest"
  keep_locally = false
}

resource "docker_container" "nginx" {
  image = docker_image.nginx.latest
  name  = "tutorial"
  ports {
    internal = 80
    external = 8000
  }
}
```

2. `terraform init`

- ë¡œì»¬ ë¨¸ì‹ ì— í”„ë¡œë°”ì´ë” ë‹¤ìš´ë¡œë“œ

3. `terraform apply` ì‹¤í–‰ í›„ `docker ps` ì‹¤í–‰

- ì»¨í…Œì´ë„ˆ ì‹¤í–‰

4. ë¸Œë¼ìš°ì €ì—ì„œ `localhost:8000`ìœ¼ë¡œ ì´ë™

- nginx ì»¨í…Œì´ë„ˆì— ì•¡ì„¸ìŠ¤ í™•ì¸

#### ğŸ“Œ ë” ë³µì¡í•œ Docker

- docker-composeë¡œ ë§Œë“  ì›Œë“œí”„ë ˆìŠ¤ì™€ MySQLìš© docker-compose íŒŒì¼ì„ ê°€ì ¸ì™€ Terraformì— ì‚½ì…

1. .tf íŒŒì¼ ìƒì„± ë° ë¦¬ì†ŒìŠ¤ ì •ì˜

```
terraform {
  required_providers {
    docker = {
      source  = "kreuzwerker/docker"
      version = "2.16.0"
    }
  }
}

provider "docker" {}

variable wordpress_port {
  default = "8080"
}

resource "docker_volume" "db_data" {
  name = "db_data"
}

resource "docker_network" "wordpress_net" {
  name = "wordpress_net"
}

resource "docker_container" "db" {
  name  = "db"
  image = "mysql:5.7"
  restart = "always"
  network_mode = "wordpress_net"
  env = [
     "MYSQL_ROOT_PASSWORD=wordpress",
     "MYSQL_PASSWORD=wordpress",
     "MYSQL_USER=wordpress",
     "MYSQL_DATABASE=wordpress"
  ]
  mounts {
    type = "volume"
    target = "/var/lib/mysql"
    source = "db_data"
    }
}

resource "docker_container" "wordpress" {
  name  = "wordpress"
  image = "wordpress:latest"
  restart = "always"
  network_mode = "wordpress_net"
  env = [
    "WORDPRESS_DB_HOST=db:3306",
    "WORDPRESS_DB_USER=wordpress",
    "WORDPRESS_DB_NAME=wordpress",
    "WORDPRESS_DB_PASSWORD=wordpress"
  ]
  ports {
    internal = "80"
    external = "${var.wordpress_port}"
  }
}
```

2. `terraform init`

- ë¡œì»¬ ë¨¸ì‹ ì— í•„ìš”í•œ provisioners ë‹¤ìš´ë¡œë“œ

3. `terraform apply` ì‹¤í–‰ í›„ `docker ps` ì‹¤í–‰

- ìƒˆë¡œ ìƒì„±ëœ ì»¨í…Œì´ë„ˆ í™•ì¸ ê°€ëŠ¥

4. ë¸Œë¼ìš°ì €ì—ì„œ `localhost:8080`ìœ¼ë¡œ ì´ë™

- WordPress í”„ë¡ íŠ¸ì—”ë“œë¡œ ì´ë™ ê°€ëŠ¥. WordPress ê²Œì‹œë¬¼ì´ MySQL ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥

#### ğŸ“Œ Provisioners

- ì–´ë–¤ ê²ƒì´ ì„ ì–¸ì ì¼ ìˆ˜ ì—†ëŠ” ê²½ìš° ì´ë¥¼ ë°°í¬ì— íŒŒì‹±í•  ìˆ˜ ìˆëŠ” ë°©ë²• ì œê³µ

- ë‹¤ë¥¸ ëŒ€ì•ˆì´ ì—†ê³  ì½”ë“œì— ë³µì¡ì„±ì„ ì¶”ê°€í•´ì•¼í•˜ëŠ” ê²½ìš° ì•„ë˜ ì½”ë“œì™€ ìœ ì‚¬í•˜ê²Œ ì‹¤í–‰í•˜ì—¬ ìˆ˜í–‰

- ì›ê²© ì‹¤í–‰ ProvisionersëŠ” ì›ê²© ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ëœ í›„ ì›ê²© ë¦¬ì†ŒìŠ¤ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ í˜¸ì¶œ

- file / local-exec / remote-exec / vendor (ansible, chef, puppet)

```
resource "docker_container" "db" {
  # ...

  provisioner "local-exec" {
    command = "echo The server's IP address is ${self.private_ip}"
  }
}
```

#### ğŸ“Œ Module

- Module : í•¨ê»˜ ì‚¬ìš©ë˜ëŠ” ì—¬ëŸ¬ ë¦¬ì†ŒìŠ¤ë¥¼ ìœ„í•œ ì»¨í…Œì´ë„ˆ. ë™ì¼í•œ ë””ë ‰í† ë¦¬ì— ìˆëŠ” .tf íŒŒì¼ ëª¨ìŒìœ¼ë¡œ êµ¬ì„±

- ì¸í”„ë¼ ë¦¬ì†ŒìŠ¤ë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆëŠ” ì¢‹ì€ ë°©ë²•ì´ë©° ì´ë¯¸ ë§Œë“¤ì–´ì§„ íƒ€ì‚¬ ëª¨ë“ˆì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆì–´ ìƒˆë¡œ ë§Œë“¤ í•„ìš”ê°€ ì—†ìŒ

ex. ë™ì¼í•œ í”„ë¡œì íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¼ë¶€ VM, VPC, ë³´ì•ˆ ê·¸ë£¹ì„ êµ¬ì¶•í•œ ë‹¤ìŒ Kubernetes í´ëŸ¬ìŠ¤í„°ë„ êµ¬ì¶•í•˜ë ¤ëŠ” ê²½ìš°, ë¦¬ì†ŒìŠ¤ë¥¼ ëª¨ë“ˆë¡œ ë¶„í• í•˜ì—¬ ë¦¬ì†ŒìŠ¤ì™€ ê·¸ë£¹í™” ìœ„ì¹˜ë¥¼ ë” ì˜ ì •ì˜í•˜ê¸¸ ì›í•¨

### Day61

- ì§€ê¸ˆê¹Œì§€ ê°€ìƒ ë¨¸ì‹ , Docker ì»¨í…Œì´ë„ˆì—ì„œ ì •ì˜í•œ ë‹¤ìŒ ë°°í¬í•´ë³´ì•˜ê³  ë³¸ ì„¹ì…˜ì—ì„œëŠ” Terraformì„ ì‚¬ìš©í•˜ì—¬ Kubernetesì—ì„œ ì§€ì›í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì™€ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë³¼ ê²ƒ

- Terraformì„ ì‚¬ìš©í•˜ì—¬ Kubernetes í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ê°ì²´ì™€ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆëŠ”ë°, ì´ëŠ” Kubernetes ê³µê¸‰ìë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ Helm ê³µê¸‰ìë¥¼ ì‚¬ìš©í•˜ì—¬ ì°¨íŠ¸ ë°°í¬ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŒ

- Kubernetes í™˜ê²½ì—ì„œ Terraform ì‚¬ìš© ì‹œì˜ ì´ì 

âœ”ï¸ í†µí•© workflow : í´ëŸ¬ìŠ¤í„° ë°°í¬ì— Terraformì„ ì‚¬ìš©í–ˆë‹¤ë©´, ë™ì¼í•œ workflowì™€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetes í´ëŸ¬ìŠ¤í„° ë‚´ì— ë°°í¬ ê°€ëŠ¥

âœ”ï¸ ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬ : Terraformì€ ë‹¨ìˆœí•œ í”„ë¡œë¹„ì €ë‹ ë„êµ¬ê°€ ì•„ë‹ˆë¼ ë³€ê²½, ì—…ë°ì´íŠ¸, ì‚­ì œ ê°€ëŠ¥

#### ğŸ“Œ ê°„ë‹¨í•œ Kubernetes ë°ëª¨

- Kubernetes í´ëŸ¬ìŠ¤í„°ì— nginx ë°°í¬ + ë°ëª¨ ëª©ì ìœ¼ë¡œ Minikube ì‚¬ìš©

1. ê³µê¸‰ì ì •ì˜ + kubeconfig íŒŒì¼ ê°€ë¦¬í‚¤ê³  nginx ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„± í›„ 2ê°œì˜ ë³µì œë³¸ê³¼ ì„œë¹„ìŠ¤ í¬í•¨í•´ ë°°í¬

```
terraform {
  required_providers {
    kubernetes = {
      source  = "hashicorp/kubernetes"
      version = ">= 2.0.0"
    }
  }
}
provider "kubernetes" {
  config_path = "~/.kube/config"
}
resource "kubernetes_namespace" "test" {
  metadata {
    name = "nginx"
  }
}
resource "kubernetes_deployment" "test" {
  metadata {
    name      = "nginx"
    namespace = kubernetes_namespace.test.metadata.0.name
  }
  spec {
    replicas = 2
    selector {
      match_labels = {
        app = "MyTestApp"
      }
    }
    template {
      metadata {
        labels = {
          app = "MyTestApp"
        }
      }
      spec {
        container {
          image = "nginx"
          name  = "nginx-container"
          port {
            container_port = 80
          }
        }
      }
    }
  }
}
resource "kubernetes_service" "test" {
  metadata {
    name      = "nginx"
    namespace = kubernetes_namespace.test.metadata.0.name
  }
  spec {
    selector = {
      app = kubernetes_deployment.test.spec.0.template.0.metadata.0.labels.app
    }
    type = "NodePort"
    port {
      node_port   = 30201
      port        = 80
      target_port = 80
    }
  }
}
```

2. `terraform init`

- `kubectl get ns`ë¥¼ í†µí•´ `terraform apply` ì‹¤í–‰ ì „ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ ì—†ëŠ” ê²ƒ í™•ì¸

3. `terraform apply`

- Kubernetes í´ëŸ¬ìŠ¤í„° ë‚´ì— 3ê°œì˜ ìƒˆë¡œìš´ ë¦¬ì†ŒìŠ¤, ë„¤ì„ìŠ¤í˜ì´ìŠ¤, ë°°í¬ ë° ì„œë¹„ìŠ¤ ìƒì„±

- `kubectl get ns`ë¥¼ í†µí•´ ë°°í¬ëœ ë¦¬ì†ŒìŠ¤ í™•ì¸

- Minikubeë¥¼ ì‚¬ìš©í•˜ê¸°ì— ë„ì»¤ ë„¤íŠ¸ì›Œí‚¹ìœ¼ë¡œ ì¸ê·¸ë ˆìŠ¤ë¥¼ ì‹œë„í•  ë•Œ í•œê³„ ì¡´ì¬. `kubectl port-forward -n nginx svc.nginx 30201:80` ëª…ë ¹ í›„ `localhost:30201`ë¡œ ë¸Œë¼ìš°ì € ì—´ë©´ nginx í˜ì´ì§€ í™•ì¸ ê°€ëŠ¥

#### ğŸ“Œ ì—¬ëŸ¬ í™˜ê²½

- ì‹¤í–‰í•œ ë°ëª¨ë¥¼ íŠ¹ì • í”„ë¡œë•ì…˜, ìŠ¤í…Œì´ì§• ë° ê°œë°œ í™˜ê²½ì´ ë™ì¼í•˜ê²Œ ë³´ì´ê³  ì½”ë“œë¥¼ í™œìš©í•˜ëŠ” ë°©ë²•

âœ”ï¸ `terraform workspaces` : ë‹¨ì¼ ë°±ì—”ë“œ ë‚´ì˜ ì—¬ëŸ¬ ê°œì˜ ëª…ëª…ëœ ì„¹ì…˜

- ì¥ì : ì‰¬ìš´ ì‹œì‘ / í¸ë¦¬í•œ terraform.workspace í‘œí˜„ì‹ / ì½”ë“œ ì¤‘ë³µ ìµœì†Œí™”

- ë‹¨ì : ì¸ì  ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê¸° ì‰¬ì›€(TFë¥¼ ì‚¬ìš©í•´ ì œê±°í•˜ë ¤ê³  ë…¸ë ¥ ì¤‘) / ë™ì¼í•œ ë°±ì—”ë“œ ë‚´ì— ì €ì¥ëœ ìƒíƒœ / ì½”ë“œë² ì´ìŠ¤ê°€ ë°°í¬ êµ¬ì„±ì„ ëª…í™•í•˜ê²Œ ë³´ì—¬ì£¼ì§€ ì•ŠìŒ

âœ”ï¸ íŒŒì¼ êµ¬ì¡° : ë””ë ‰í† ë¦¬ ë ˆì´ì•„ì›ƒì€ ë¶„ë¦¬ë¥¼ ì œê³µí•˜ê³  ëª¨ë“ˆì€ ì¬ì‚¬ìš© ì œê³µ

- ì¥ì : ë°±ì—”ë“œ ê²©ë¦¬ (ë³´ì•ˆ í–¥ìƒ+ì¸ì  ì˜¤ë¥˜ ê°€ëŠ¥ì„± ê°ì†Œ) / ë°°í¬ëœ ìƒíƒœë¥¼ ì™„ë²½í•˜ê²Œ ë‚˜íƒ€ë‚´ëŠ” ì½”ë“œ ë² ì´ìŠ¤

- ë‹¨ì : í”„ë¡œë¹„ì €ë‹ í™˜ê²½ì— ì—¬ëŸ¬ terraform ì ìš© í•„ìš” / ì½”ë“œ ì¤‘ë³µì´ ë” ë§ì§€ë§Œ ëª¨ë“ˆì„ ì‚¬ìš©í•´ ìµœì†Œí™” ê°€ëŠ¥

### Day62

#### ğŸ“Œ í…ŒìŠ¤íŠ¸, ë„êµ¬ ë° ëŒ€ì•ˆ

1. Code Rot

- ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì™€ ë‹¬ë¦¬ ì½”ë“œë¡œì„œì˜ ì¸í”„ë¼ëŠ” í•œ ë²ˆ ì‚¬ìš©ë˜ì—ˆë‹¤ê°€ ì˜¤ë«ë™ì•ˆ ì‚¬ìš©í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŒ

- Terraformì„ ì‚¬ìš©í•˜ì—¬ AWSì— VM í™˜ê²½ì„ ë°°í¬í•˜ë ¤ê³  í•˜ëŠ”ë°, ì²˜ìŒì— ì™„ë²½í•˜ê²Œ ì‘ë™í•˜ê³  í™˜ê²½ì´ ê°–ì¶°ì¡Œì§€ë§Œ ì´ í™˜ê²½ì´ ìì£¼ ë³€ê²½ë˜ì§€ ì•Šì•„ ì½”ë“œê°€ ì¤‘ì•™ ìœ„ì¹˜ì— ì €ì¥ë˜ê¸°ë¥¼ ë°”ë¼ì§€ë§Œ ì½”ë“œê°€ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ìƒíƒœë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•œë‹¤ê³  ê°€ì •

=> ì¸í”„ë¼ì— ë³€í™”ê°€ ìƒê¸´ ê²½ìš°, ëŒ€ì—­ ì™¸ ë³€ê²½ ì‚¬í•­ / ê³ ì •ë˜ì§€ ì•Šì€ ë²„ì „ / ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì¢…ì†ì„± / ì ìš©ë˜ì§€ ì•ŠëŠ” ë³€ê²½ ì‚¬í•­

2. í…ŒìŠ¤íŠ¸

- ëª¨ë“  ì˜ì—­ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ê¸°ëŠ¥

|       Command        |                            Description                            |
| :------------------: | :---------------------------------------------------------------: |
|   `terraform fmt`    |       Terraform êµ¬ì„± íŒŒì¼ì„ í‘œì¤€ í˜•ì‹ê³¼ ìŠ¤íƒ€ì¼ë¡œ ë‹¤ì‹œ ì‘ì„±        |
| `terraform validate` |     ë””ë ‰í† ë¦¬ì— ìˆëŠ” êµ¬ì„± íŒŒì¼ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ì—¬ êµ¬ì„±ë§Œ ì°¸ì¡°     |
|   `terraform plan`   |    ì‹¤í–‰ ê³„íšì„ ìƒì„±í•˜ì—¬ terraformì´ ê³„íší•œ ë³€ê²½ ì‚¬í•­ì„ ë¯¸ë¦¬ ë´„    |
|  Custom validation   | ì…ë ¥ ë³€ìˆ˜ê°€ ì˜ˆìƒê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•œ ì…ë ¥ ë³€ìˆ˜ ìœ íš¨ì„± ê²€ì‚¬ |

1. Terraform ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í…ŒìŠ¤íŠ¸ ë„êµ¬

- tflint : ê°€ëŠ¥í•œ ì˜¤ë¥˜ ì°¾ê¸° / ë”ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” êµ¬ë¬¸ê³¼ ì„ ì–¸ì— ëŒ€í•´ ê²½ê³  / ëª¨ë²” ì‚¬ë¡€ì™€ ëª…ëª… ê·œì¹™ ì ìš©

2. ê²€ì‚¬ ë„êµ¬

- checkov : í´ë¼ìš°ë“œ ì¸í”„ë¼ êµ¬ì„±ì„ ìŠ¤ìº”í•˜ì—¬ ë°°í¬í•˜ê¸° ì „ì— ì˜ëª»ëœ êµ¬ì„± ì°¾ê¸°

- tfsec : terraform ì½”ë“œì— ëŒ€í•œ ì •ì  ë¶„ì„ ë³´ì•ˆ ìŠ¤ìºë„ˆ

- terrascan : IaCë¥¼ ìœ„í•œ ì •ì  ì½”ë“œ ë¶„ì„ê¸°

- terraform-compliance : IaCì— ëŒ€í•œ ë„¤ê±°í‹°ë¸Œ í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥ ì§€ì›

- snyk : terraform ì½”ë“œì—ì„œ ì˜ëª»ëœ êµ¬ì„±ê³¼ ë³´ì•ˆ ë¬¸ì œ ìŠ¤ìº”

3. ê´€ë¦¬í˜• í´ë¼ìš°ë“œ ì œí’ˆ

- Terraform Sentinel

3. ìë™í™”ëœ í…ŒìŠ¤íŠ¸

- Terratest

- Terraform í´ë¼ìš°ë“œ

- Terragrunt

- Atlantis

4. ëŒ€ì•ˆ

- `Pulumi` : Terraformê³¼ Pulumi ì›í•˜ëŠ” ì¸í”„ë¼ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì½”ë“œ ëª¨ë¸ë¡œ ì›í•˜ëŠ” ìƒíƒœ ì¸í”„ë¼ ì œê³µ. But PulumiëŠ” HCLê³¼ ë‹¬ë¦¬ Python, TypeScript, Javascript, Go, .NETê³¼ ê°™ì€ ë²”ìš© ì–¸ì–´ í—ˆìš©

## Automate Configuration Management

### Day63

#### ğŸ“Œ êµ¬ì„± ê´€ë¦¬

1. êµ¬ì„± ê´€ë¦¬ : ì• í”Œë¦¬ì¼€ì´ì…˜, ì‹œìŠ¤í…œ, ì„œë²„ë¥¼ ì›í•˜ëŠ” ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” í”„ë¡œì„¸ìŠ¤

2. êµ¬ì„± ê´€ë¦¬ ì‚¬ìš© ì´ìœ 

- êµ¬ì„± ê´€ë¦¬ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ë©´ ì‹œìŠ¤í…œì— ì¥ì• ê°€ ë°œìƒí•˜ê±°ë‚˜ ì„œë²„ê°€ ë‹¤ìš´ë˜ëŠ” ê²½ìš°, ì‹œìŠ¤í…œ ê´€ë¦¬ìê°€ ê° ì„œë²„ë¥¼ ë¹ ë¥´ê³  íš¨ê³¼ì ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ì§€ì¹¨ì„ í‘¸ì‹œ

3. êµ¬ì„± ê´€ë¦¬ ë„êµ¬

1) Chef

- ì¸í”„ë¼ ìë™í™”ë¥¼ í†µí•´ ëª¨ë“  í™˜ê²½, ëª¨ë“  ê·œëª¨ì—ì„œ êµ¬ì„±ì´ ì¼ê´€ë˜ê²Œ ì ìš©ë˜ë„ë¡ ë³´ì¥

- Rubyì™€ Erlangìœ¼ë¡œ ì‘ì„±ëœ OpsCodeì—ì„œ ê°œë°œí•œ ì˜¤í”ˆ ì†ŒìŠ¤ ë„êµ¬

- ì¥ì : ê°•ë ¥í•œ ë²„ì „ ì œì–´ë¥¼ ì œê³µí•˜ëŠ” Gitê³¼ ì˜ í†µí•©ë¨

- ë‹¨ì : í•™ìŠµ ê³¡ì„ ì´ ê°€íŒŒë¥´ë©° ìƒë‹¹í•œ ì‹œê°„ì´ í•„ìš” / ë©”ì¸ ì„œë²„ì—ì„œ ì œì–´í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ë§ì§€ ì•ŠìŒ

- ì•„í‚¤í…ì²˜: ì„œë²„/í´ë¼ì´ì–¸íŠ¸

- ì„¤ì • ìš©ì´ì„±: ë³´í†µ

- ì–¸ì–´: ì ˆì°¨ì  - ì‘ì—… ìˆ˜í–‰ ë°©ë²• ì§€ì •

2. Puppet

- ìë™ ë°°í¬ë¥¼ ì§€ì›í•˜ëŠ” êµ¬ì„± ê´€ë¦¬ ë„êµ¬

- ì¥ì : ì§€ì›ì„ ìœ„í•œ ëŒ€ê·œëª¨ ì»¤ë®¤ë‹ˆí‹° ì¡´ì¬ / ì˜ ë°œë‹¬ëœ ëŒ€ê·œëª¨ ì»¤ë®¤ë‹ˆí‹°

- ë‹¨ì : ê³ ê¸‰ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë ¤ë©´ Ruby ì–¸ì–´ì— ëŒ€í•œ ì§€ì‹ í•„ìš” / ë©”ì¸ ì„œë²„ì— ëŒ€í•œ ì œì–´ ê¶Œí•œì´ ë§ì§€ ì•ŠìŒ

- ì•„í‚¤í…ì²˜: ì„œë²„/í´ë¼ì´ì–¸íŠ¸

- ì„¤ì • ìš©ì´ì„±: ë³´í†µ

- ì–¸ì–´: ì„ ì–¸ì  - ìˆ˜í–‰í•  ì‘ì—…ë§Œ ì§€ì • ê°€ëŠ¥

3. Ansible

- êµ¬ì„± ê´€ë¦¬, í´ë¼ìš°ë“œ í”„ë¡œë¹„ì €ë‹, ë°°í¬ ë° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ì„ ìë™í™”í•˜ëŠ” IT ìë™í™” ë„êµ¬

- YAMLë¡œ ì‘ì„±

- ì¥ì : ì›ê²© ë…¸ë“œì— ì—ì´ì „íŠ¸ê°€ í•„ìš”í•˜ì§€ ì•ŠìŒ / YAMLì€ ë°°ìš°ê¸° ì‰¬ì›€

- ë‹¨ì : ì„±ëŠ¥ ì†ë„ê°€ ë‹¤ë¥¸ ë„êµ¬ë³´ë‹¤ ëŠë¦° ê²½ìš° ë§ìŒ / YAMLì€ Rubyë§Œí¼ ê°•ë ¥í•˜ì§€ëŠ” ì•Šì§€ë§Œ í•™ìŠµ ê³¡ì„ ì´ ì ìŒ

- ì•„í‚¤í…ì²˜: í´ë¼ì´ì–¸íŠ¸ ì „ìš©

- ì„¤ì • ìš©ì´ì„±: ë§¤ìš° ì‰¬ì›€

- ì–¸ì–´: ì ˆì°¨ì  - ì‘ì—… ìˆ˜í–‰ ë°©ë²• ì§€ì •

4. SaltStack

- êµ¬ì„± ê´€ë¦¬ì™€ ì›ê²© ì‹¤í–‰ì„ ìë™í™”í•˜ëŠ” CLI ê¸°ë°˜ ë„êµ¬

- Python ê¸°ë°˜ì´ë©° ëª…ë ¹ì–´ëŠ” YAML ë˜ëŠ” í•´ë‹¹ DSLë¡œ ì‘ì„±

- í™•ì¥ì„±ê³¼ ë³µì›ë ¥ì„ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤í•˜ëŠ” í™˜ê²½ì— ì í•©

- ì¥ì : ê°€ë™ ë° ì‹¤í–‰ ì‹œ ì‚¬ìš©ì´ ê°„í¸ / ìš°ìˆ˜í•œ ë³´ê³  ë©”ì»¤ë‹ˆì¦˜

- ë‹¨ì : ì„¤ì • ë‹¨ê³„ê°€ ê¹Œë‹¤ë¡œì›€ / ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë³´ë‹¤ í›¨ì”¬ ëœ ê°œë°œëœ ìƒˆë¡œìš´ ì›¹ UI ì¡´ì¬

- ì•„í‚¤í…ì²˜: ì„œë²„/í´ë¼ì´ì–¸íŠ¸

- ì„¤ì • ìš©ì´ì„±: ë³´í†µ

- ì–¸ì–´: ì„ ì–¸ì  - ìˆ˜í–‰í•  ì‘ì—…ë§Œ ì§€ì • ê°€ëŠ¥

#### ğŸ“Œ Ansibleê³¼ Terraform ë¹„êµ

|                   |                  Ansible                   |                   Terraform                    |
| :---------------: | :----------------------------------------: | :--------------------------------------------: |
|       ìœ í˜•        |               êµ¬ì„± ê´€ë¦¬ ë„êµ¬               |              ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë„êµ¬               |
|      ì¸í”„ë¼       |          ë³€ê²½ ê°€ëŠ¥í•œ ì¸í”„ë¼ ì§€ì›           |           ë³€ê²½ ë¶ˆê°€ëŠ¥í•œ ì¸í”„ë¼ ì§€ì›            |
|       ì–¸ì–´        |                ì ˆì°¨ì  ì–¸ì–´                 |                  ì„ ì–¸ì  ì–¸ì–´                   |
|    í”„ë¡œë¹„ì €ë‹     | ë¶€ë¶„ í”„ë¡œë¹„ì €ë‹(VM,ë„¤íŠ¸ì›Œí¬,ìŠ¤í† ë¦¬ì§€) ì œê³µ | ê´‘ë²”ìœ„í•œ í”„ë¡œë¹„ì €ë‹(VM,ë„¤íŠ¸ì›Œí¬,ìŠ¤í† ë¦¬ì§€) ì œê³µ |
|      íŒ¨í‚¤ì§•       |  íŒ¨í‚¤ì§• ë° í…œí”Œë¦¿ì— ëŒ€í•œ ì™„ë²½í•œ ì§€ì› ì œê³µ  |     íŒ¨í‚¤ì§• ë° í…œí”Œë¦¿ì— ëŒ€í•œ ë¶€ë¶„ ì§€ì› ì œê³µ     |
| ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬ |       ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬ ê¸°ëŠ¥ ì¡´ì¬ X        |     ë¼ì´í”„ì‚¬ì´í´ ë° ìƒíƒœ ê´€ë¦¬ì— í¬ê²Œ ì˜ì¡´      |

### Day64

#### ğŸ“Œ Ansible íŠ¹ì§•

1. RedHatì—ì„œ ì œê³µ

2. ì—ì´ì „íŠ¸ê°€ ì—†ìœ¼ë©° SSHë¥¼ í†µí•´ ì—°ê²°í•˜ê³  ëª…ë ¹ ì‹¤í–‰

3. í¬ë¡œìŠ¤ í”Œë«í¼(Linux ë° macOS, WSL2) ë° ì˜¤í”ˆ ì†ŒìŠ¤(ì—”í„°í”„ë¼ì´ì¦ˆìš© ìœ ë£Œ ì˜µì…˜ ì¡´ì¬)

4. ë‹¤ë¥¸ ëª¨ë¸ì— ë¹„í•´ êµ¬ì„±ì„ push

#### ğŸ“Œ Ansible ì„¤ì¹˜

- Ansibleì€ ì—ì´ì „íŠ¸ê°€ ì—†ëŠ” ìë™í™” ë„êµ¬ì´ë©°, ì´ ë„êµ¬ëŠ” "Control Node"ë¼ê³  í•˜ëŠ” ì‹œìŠ¤í…œì— ë°°í¬ë˜ê³  ì´ Control Nodeì—ì„œ SSHë¥¼ í†µí•´ ë¨¸ì‹  ë° ê¸°íƒ€ ì¥ì¹˜(ex.ë„¤íŠ¸ì›Œí¬) ê´€ë¦¬

1. Windows OSë¥¼ Control Nodeë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ Linux ì„¹ì…˜ì—ì„œ ë§Œë“  Linux VMì„ Control Nodeë¡œ ì‚¬ìš©

- ì•„ë˜ ëª…ë ¹ì–´ë¡œ ì„¤ì¹˜

```
sudo apt update
sudo apt install software-properties-common
sudo add-apt-repository --yes --update ppa:ansible/ansible
sudo apt install ansible
```

2. Control Nodeì— ansibleì´ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•˜ë©°, `ansible --version`ì„ ì‹¤í–‰í•˜ì—¬ í™•ì¸ ê°€ëŠ¥

3. ë¡œì»¬ ë¨¸ì‹ ì— `ansible localhost -m ping`

- Ansible ëª¨ë“ˆ ì‚¬ìš© ëª…ë ¹ì–´ë¡œ, ì—¬ëŸ¬ ì‹œìŠ¤í…œì—ì„œ í•˜ë‚˜ì˜ ì‘ì—…ì„ ë¹ ë¥´ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ë°©ë²•

- ansible ê¸°ëŠ¥ í™•ì¸

- ì‹¤ì œ ëª¨ë“ˆ ì‚¬ìš©ë²•ì€ `ansible webservers -m service -a "name=httpd state=started"`ì™€ ê°™ì´ ëª¨ë“  ì›¹ì„œë²„ì— httpd ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ ì—¬ë¶€ë¥¼ ì•Œë ¤ì£¼ëŠ” ê²ƒ

#### ğŸ“Œ í˜¸ìŠ¤íŠ¸

âš¡ï¸ í™˜ê²½ì˜ ë‹¤ë¥¸ node ì œì–´í•˜ëŠ” ë°©ë²•

- ìœ„ì—ì„œ localhostë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œìŠ¤í…œì— ëŒ€í•œ í•‘ ëª¨ë“ˆì„ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì€ ë„¤íŠ¸ì›Œí¬ì— ë‹¤ë¥¸ ì»´í“¨í„°ë¥¼ ì§€ì •í•  ìˆ˜ ì—†ìŒ

ex. VirtualBoxê°€ ì‹¤í–‰ì¤‘ì¸ Windows í˜¸ìŠ¤íŠ¸ì—ëŠ” IP 10.0.0.1ì˜ ë„¤íŠ¸ì›Œí¬ ì–´ëŒ‘í„°ê°€ ìˆì–´ í•‘ìœ¼ë¡œ ì—°ê²°í•  ìˆ˜ ìˆì§€ë§Œ ansibleì„ ì‚¬ìš©í•´ í•´ë‹¹ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ëŠ” ì—†ìŒ

=> ìë™í™”í•  í˜¸ìŠ¤íŠ¸ ë˜ëŠ” Nodeë¥¼ ì§€ì •í•˜ë ¤ë©´ ì´ë¥¼ ì •ì˜í•´ì•¼í•¨

1. `cd /etc/ansible`

- ì‹œìŠ¤í…œì˜ /etc/ansible ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•˜ì—¬ ì •ì˜

- í¸ì§‘í•˜ë ¤ëŠ” íŒŒì¼ì€ hosts íŒŒì¼ì´ë©°, í…ìŠ¤íŠ¸ í¸ì§‘ê¸°ë¥¼ í†µí•´ hosts ì •ì˜ ê°€ëŠ¥

2. í…ìŠ¤íŠ¸ í¸ì§‘ê¸°ë¥¼ í†µí•´ hosts íŒŒì¼ í¸ì§‘

- ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤í•´ [windows]ë¼ëŠ” ìƒˆ ê·¸ë£¹ì„ ë§Œë“¤ê³  í•´ë‹¹ í˜¸ìŠ¤íŠ¸ì— ëŒ€í•œ `10.0.0.1` IP ì£¼ì†Œ ì¶”ê°€ í›„ íŒŒì¼ ì €ì¥

- `ansible windows -m ping`ì„ ì‹¤í–‰í•˜ë©´ SSHë¥¼ í†µí•œ ì—°ê²°ì— ì‹¤íŒ¨í•˜ì—¬ ì—°ê²°í•  ìˆ˜ ì—†ë‹¤ëŠ” ë©”ì„¸ì§€ í‘œì‹œ => Ansibleì´ ì‹œìŠ¤í…œì— ì—°ê²°í•˜ë ¤ë©´ SSHë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì•¼ í•¨

3. hosts íŒŒì¼ì— Linux ì‹œìŠ¤í…œ ê·¸ë£¹ì— ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•œ ìê²© ì¦ëª… ì¶”ê°€

- [windows] ì•„ë˜ì— [Linux] 10.0.2.15 ì¶”ê°€ + [linux:vars] ansible_user=vagrant / ansible_password=vagrant ì¶”ê°€

- `ansible Linux -m ping` ì‹¤í–‰ => ì„±ê³µ

âœ”ï¸ êµ¬ì„±ì„ ìë™í™”í•˜ë ¤ëŠ” ëŒ€ìƒ ì‹œìŠ¤í…œì¸ Node ìš”êµ¬ ì‚¬í•­ ì¡´ì¬ : Ansibleì„ ìœ„í•œ ì–´ë–¤ ê²ƒë„ ì„¤ì¹˜í•˜ì§€ ì•ŠìŒ. Ansibleì€ SSHë¥¼ í†µí•´ ì—°ê²°í•˜ê³  SFTPë¥¼ í†µí•´ ëª¨ë“  ê²ƒ ì „ì†¡ (ì›í•˜ëŠ” ê²½ìš° SSHë¥¼ êµ¬ì„±í•œ ê²½ìš° SCP ëŒ€ SFTP ì‚¬ìš© ê°€ëŠ¥)

#### ğŸ“Œ Ansible ëª…ë ¹

âœ”ï¸ Ansibleì„ ì‚¬ìš©í•˜ë©´ ë§ì€ adhoc ëª…ë ¹ ì‹¤í–‰ ê°€ëŠ¥. ì´ ëª…ë ¹ì„ ì‹œìŠ¤í…œ ê·¸ë£¹ì— ëŒ€í•´ ì‹¤í–‰í•˜ì—¬ í•´ë‹¹ ì •ë³´ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ

- adhoc ëª…ë ¹ì€ ì„ ì–¸ì  ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ì§€ì •ëœ ìµœì¢… ìƒíƒœì— ë„ë‹¬í•˜ëŠ”ë° í•„ìš”í•œ ì‘ì—…ì„ ê³„ì‚°í•˜ê³  ì‹¤í–‰. ì‹œì‘í•˜ê¸° ì „ì— í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  í˜„ì¬ ìƒíƒœê°€ ì§€ì •ëœ ìµœì¢… ìƒíƒœì™€ ë‹¤ë¥´ì§€ ì•Šìœ¼ë©´ ì•„ë¬´ ì‘ì—… ìˆ˜í–‰ X

âœ”ï¸ ëª…ë ¹ì„ ë°˜ë³µí•˜ê±°ë‚˜ ì´ëŸ¬í•œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ê°œë³„ ì‹œìŠ¤í…œì— ë¡œê·¸ì¸í•´ì•¼ í•˜ëŠ” ê²½ìš° Ansibleì´ ë„ì›€ì´ ë  ìˆ˜ ìˆìŒ

ex. `ansible linux -a "cat /etc/os-release"` ëª…ë ¹ì€ Linux ê·¸ë£¹ì— ì¶”ê°€í•˜ëŠ” ëª¨ë“  ì‹œìŠ¤í…œì— ëŒ€í•œ ëª¨ë“  ìš´ì˜ ì²´ì œ ì„¸ë¶€ ì •ë³´ ì¶œë ¥

### Day65

#### ğŸ“Œ Ansible Playbook

âœ”ï¸ Ansibleì˜ ê²½ìš° í•˜ë‚˜ì˜ ëª…ë ¹ìœ¼ë¡œ ì—¬ëŸ¬ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ì—¬ ê°„ë‹¨í•œ ëª…ë ¹ì„ ìˆ˜í–‰í•˜ê³ , ê° ì„œë²„ì— ê°œë³„ì ìœ¼ë¡œ ì—°ê²°í•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ê°€ì¥ í° ì¥ì 

âœ”ï¸ Ansible Playbookì„ ì‚¬ìš©í•˜ë©´ ì„œë²„ ê·¸ë£¹ì„ ê°€ì ¸ì™€ì„œ í•´ë‹¹ ê·¸ë£¹ì— ëŒ€í•œ êµ¬ì„± ë° ì„¤ì¹˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŒ

#### ğŸ“Œ Ansible Playbook í˜•ì‹

1. Playbook

: YAML(ë§ˆí¬ì—… ì–¸ì–´ê°€ ì•„ë‹˜)ë¡œ ì‘ì„±ë˜ì–´ ìˆìŒ

**Playbook > Play > Task**

ex. playbook.yml

```
- name: Simple Play
  hosts: localhost
  connection: local
  tasks:
    - name: Ping me
      ping:
    - name: print os
      debug:
        msg: "{{ ansible_os_family }}"
```

2. playbook ì‹¤í–‰

1) `ansible-playbook simple_play.yml` ëª…ë ¹ì–´ ì‹¤í–‰

2) ê²°ê³¼
   ![Alt text](image-2.png)

3) ì„¤ëª…

âœ”ï¸ ì²«ë²ˆì§¸ TASK 'gathering facts'

=> ì›ê²© í˜¸ìŠ¤íŠ¸ì— ëŒ€í•œ ìœ ìš©í•œ ë³€ìˆ˜ë¥¼ ìˆ˜ì§‘í•˜ê¸° ìœ„í•´ Playbookì—ì„œ ìë™ í˜¸ì¶œ

âœ”ï¸ ë‘ë²ˆì§¸ TASK 'Ping'

=> ì›ê²© ë˜ëŠ” ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì— ëŒ€í•œ ì—°ê²° ì„±ê³µì‹œ `pong`ì„ ë°˜í™˜í•˜ëŠ” íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸

âœ”ï¸ ì„¸ë²ˆì§¸ TASK

=> ì²«ë²ˆì§¸ TASKë¡œ ì •ì˜í•œ ì„¸ë²ˆì§¸ TASKëŠ” OSë¥¼ ì•Œë ¤ì£¼ëŠ” ë©”ì‹œì§€ ì¸ì‡„ë¥¼ ë¹„í™œì„±í•˜ì§€ ì•Šì€ í•œ ì‹¤í–‰ë¨

=> ì¡°ê±´ë¬¸ì„ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë¯€ë¡œ ëª¨ë“  ìœ í˜•ì˜ ìš´ì˜ ì²´ì œì— ëŒ€í•œ Playbookì„ ì‹¤í–‰í•  ìˆ˜ ìˆìœ¼ë©° ê·¸ëŸ¬í•œ ê²½ìš° OS ì´ë¦„ ë°˜í™˜. ìœ„ ì¶œë ¥ì€ ì•„ë˜ì˜ Taskë¥¼ ì¶”ê°€í•œ ê²½ìš° ë‚˜íƒ€ë‚˜ëŠ” ì¶œë ¥

```
tasks:
  - name: "shut down Debian flavoured systems"
    command: /sbin/shutdown -t now
    when: ansible_os_family == "Debian"
```

#### ğŸ“Œ Vagrantë¡œ í™˜ê²½ ì„¤ì •í•˜ê¸°

- Vagrantë¥¼ ì‚¬ìš©í•˜ì—¬ Node í™˜ê²½ ì„¤ì •

- `vagrant up` ëª…ë ¹ì„ ì‚¬ìš©í•´ VirtualBoxì—ì„œ ë¨¸ì‹  ìŠ¤í•€ì—…í•˜ë©´ ë©”ëª¨ë¦¬ ì¶”ê°€ì™€ ê° ë¨¸ì‹ ì— ëŒ€í•œ private_network ì£¼ì†Œ ì •ì˜ ê°€ëŠ¥

```
Vagrant.configure("2") do |config|
  servers=[
    {
      :hostname => "db01",
      :box => "bento/ubuntu-21.10",
      :ip => "192.168.169.130",
      :ssh_port => '2210'
    },
    {
      :hostname => "web01",
      :box => "bento/ubuntu-21.10",
      :ip => "192.168.169.131",
      :ssh_port => '2211'
    },
    {
      :hostname => "web02",
      :box => "bento/ubuntu-21.10",
      :ip => "192.168.169.132",
      :ssh_port => '2212'
    },
    {
      :hostname => "loadbalancer",
      :box => "bento/ubuntu-21.10",
      :ip => "192.168.169.134",
      :ssh_port => '2213'
    }

  ]

config.vm.base_address = 600

  servers.each do |machine|

    config.vm.define machine[:hostname] do |node|
      node.vm.box = machine[:box]
      node.vm.hostname = machine[:hostname]

      node.vm.network :public_network, bridge: "Intel(R) Ethernet Connection (7) I219-V", ip: machine[:ip]
      node.vm.network "forwarded_port", guest: 22, host: machine[:ssh_port], id: "ssh"

      node.vm.provider :virtualbox do |v|
        v.customize ["modifyvm", :id, "--memory", 2048]
        v.customize ["modifyvm", :id, "--name", machine[:hostname]]
      end
    end
  end

end
```

- ë¦¬ì†ŒìŠ¤ê°€ ì œí•œë˜ì–´ ìˆëŠ” ê²½ìš° `vagrant up web01 web02`ë¥¼ ì‹¤í–‰í•˜ì—¬ ì—¬ê¸°ì„œ ì‚¬ìš© ì¤‘ì¸ ì›¹ì„œë²„ë§Œ ë¶ˆëŸ¬ì˜´

#### ğŸ“Œ Ansible í˜¸ìŠ¤íŠ¸ êµ¬ì„±

1. ìš°ë¶„íˆ¬ ë°ìŠ¤í¬í†±ì„ ì»¨íŠ¸ë¡¤ë¡œ ì‚¬ìš©í•˜ê³  ansible hosts íŒŒì¼ì— ìƒˆ Node ê·¸ë£¹ ì¶”ê°€

- hosts íŒŒì¼ì„ ì¸ë²¤í† ë¦¬ë¡œ ìƒê°í•  ìˆ˜ ìˆìœ¼ë©° `-i filename`ì„ ì‚¬ìš©í•˜ì—¬ ansible ëª…ë ¹ì˜ ì¼ë¶€ë¡œ í˜¸ì¶œë˜ëŠ” ë˜ ë‹¤ë¥¸ ì¸ë²¤í† ë¦¬ íŒŒì¼ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

- ê¸°ë³¸ í˜¸ìŠ¤íŠ¸ íŒŒì¼ì— ì•„ë˜ ì½”ë“œ ì¶”ê°€

```
[control]
ansible-control

[proxy]
loadbalancer

[webservers]
web01
web02

[database]
db01
```

2. `ansible nodes -m command -a hostname`

- Nodeì— ëŒ€í•´ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸. ì—°ê²°ì´ ìˆëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ê³  í˜¸ìŠ¤íŠ¸ ì´ë¦„ ë‹¤ì‹œ ë³´ê³ 

- ì—°ê²°ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ /etc/hosts íŒŒì¼ ë‚´ì˜ Ubuntu ì œì–´ Nodeì— í•´ë‹¹ Nodeì™€ IP ì¶”ê°€

```
192.168.169.140 ansible-control
192.168.169.130 db01
192.168.169.131 web01
192.168.169.132 web02
192.168.169.133 loadbalancer
```

3. ì œì–´ Nodeì™€ ì„œë²„ Node ì‚¬ì´ì˜ SSH í‚¤ ì„¤ì •

- SSHë¥¼ ì„¤ì •í•˜ê³  Node ê°„ì— ê³µìœ í•˜ë ¤ë©´ ì•„ë˜ ë‹¨ê³„ ë”°ë¼ì•¼ í•¨

1. ë¹„ë°€ë²ˆí˜¸(vagrant)ë¥¼ ë¬»ëŠ” ë©”ì‹œì§€ê°€ í‘œì‹œë˜ë©´ yë¥¼ ëª‡ ë²ˆ ëˆŒëŸ¬ì•¼ ìˆ˜ë½í•  ìˆ˜ ìˆìŒ

2. `ssh-keygen` > `ssh-copy-id localhost`

3. ëª¨ë“  VMì´ ì¼œì ¸ìˆë‹¤ë©´ `ssh-copy-id web01 && ssh-copy-id web02 && ssh-copy-id loadbalancer && ssh-copy-id db01` ì‹¤í–‰ => ë¹„ë°€ë²ˆí˜¸ ì…ë ¥í•˜ë¼ëŠ” ë©”ì„¸ì§€ í‘œì‹œ (ë¹„ë°€ë²ˆí˜¸ `vagrant`)

4. ëª¨ë“  VMì„ ì‹¤í–‰í•˜ì§€ ì•Šê³  ì›¹ì„œë²„ë§Œ ì‹¤í–‰í•˜ê³  ìˆìœ¼ë¯€ë¡œ `ssh-copy-id web01 && ssh-copy-id web02` ë°œê¸‰

5. Playbook ì‹¤í–‰ ì „ ê·¸ë£¹ê³¼ ì—°ê²° í…ŒìŠ¤íŠ¸

`ansible webservers -m ping`

#### ğŸ“Œ Ansible Playbook

- ìœ„ì˜ Ansible Playbookì€ ì›¹ ì„œë²„ë¥¼ êµ¬ì„±í•˜ëŠ” ê²ƒìœ¼ë¡œ, í˜¸ìŠ¤íŠ¸ íŒŒì¼ì—ì„œ [webservers] ê·¸ë£¹ ì•„ë˜ì— ì›¹ ì„œë²„ë¥¼ ê·¸ë£¹í™”í•¨

- Playbook ì‹¤í–‰ ì „ web01ê³¼ web02ì— apacheê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ => SSHë¡œ ì ‘ì†

- ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šìœ¼ë¯€ë¡œ ì•„ë˜ Playbook ì‹¤í–‰

- Playbook

1. `host: webserver` ëŠ” ì´ Playbookì„ ì‹¤í–‰í•  ê·¸ë£¹ì´ ì›¹ì„œë²„ ê·¸ë£¹ì„ì„ ì˜ë¯¸

2. `become: yes`ëŠ” Playbookì„ ì‹¤í–‰í•˜ëŠ” ì‚¬ìš©ìê°€ ì›ê²© ì‹œìŠ¤í…œì—ì„œ ë£¨íŠ¸ê°€ ë¨ì„ ì˜ë¯¸. ë£¨íŠ¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë¼ëŠ” ë©”ì‹œì§€ í‘œì‹œ

3. `vars` ëŠ” ì›¹ì„œë²„ ì „ì²´ì—ì„œ ì›í•˜ëŠ” ëª‡ê°€ì§€ í™˜ê²½ ë³€ìˆ˜ ì •ì˜

4. Task1ì€ apacheê°€ ìµœì‹  ë²„ì „ì„ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸

5. Task2ëŠ” template í´ë”ì— ìˆëŠ” ì†ŒìŠ¤ì—ì„œ ports.conf íŒŒì¼ì„ ì‘ì„±í•˜ëŠ” ê²ƒ

6. Task3ì€ ê¸°ë³¸ index.html íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ê²ƒ

7. Task4ëŠ” apacheê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ëŠ” ê²ƒ

8. HandlerëŠ” ì•Œë¦¼ì„ ë°›ì„ ë•Œë§Œ ì‹¤í–‰ë˜ëŠ” íƒœìŠ¤í¬

```
- hosts: webservers
  become: yes
  vars:
    http_port: 8000
    https_port: 4443
    html_welcome_msg: "Hello 90DaysOfDevOps"
  tasks:
  - name: ensure apache is at the latest version
    apt:
      name: apache2
      state: latest

  - name: write the apache2 ports.conf config file
    template:
      src: templates/ports.conf.j2
      dest: /etc/apache2/ports.conf
    notify:
    - restart apache

  - name: write a basic index.html file
    template:
      src: templates/index.html.j2
      dest: /var/www/html/index.html
    notify:
    - restart apache

  - name: ensure apache is running
    service:
      name: apache2
      state: started

  handlers:
    - name: restart apache
      service:
        name: apache2
        state: restarted
```

#### ğŸ“Œ Playbook ì‹¤í–‰

1. `ansible-playbook playbook1.yml` ëª…ë ¹ì–´ë¡œ ì‹¤í–‰

2. Node(web01)ë¡œ ì´ë™í•´ ì†Œí”„íŠ¸ì›¨ì–´ ì„¤ì¹˜ í™•ì¸

`apache2 -v`

3. ì›¹ ë¸Œë¼ìš°ì € ì´ë™

- ë‘ ê°œì˜ ë…ë¦½í˜• ì›¹ ì„œë²„ë¥¼ ë°°í¬í–ˆìœ¼ë¯€ë¡œ ì •ì˜í•œ ê°ê°ì˜ IPë¡œ ì´ë™í•´ ìƒˆ ì›¹ ì‚¬ì´íŠ¸ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ

### Day66

#### ğŸ“Œ Playbook : Task, Handler ë¶„ë¦¬

- ì¶”ê°€ ìë™í™” ë° ë°°í¬ë¥¼ ì‹œì‘í•˜ê¸° ì „ì— Playbookì„ ê°„ê²°í•˜ê³  ê¹”ë”í•˜ê²Œ ìœ ì§€í•˜ëŠ” ê¸°ëŠ¥ê³¼ Taskì™€ Handlerë¥¼ í•˜ìœ„ í´ë”ë¡œ ë¶„ë¦¬í•˜ëŠ” ë°©ë²•

1. Taskë¥¼ í´ë” ë‚´ì˜ í•´ë‹¹ íŒŒì¼ì— ë³µì‚¬

```
- name: ensure apache is at the latest version
  apt: name=apache2 state=latest

- name: write the apache2 ports.conf config file
  template:
    src=templates/ports.conf.j2
    dest=/etc/apache2/ports.conf
  notify: restart apache

- name: write a basic index.html file
  template:
    src: templates/index.html.j2
    dest: /var/www/html/index.html
  notify:
  - restart apache

- name: ensure apache is running
  service:
    name: apache2
    state: started
```

2. Handlerë„ ë³µì‚¬

```
- name: restart apache
  service:
    name: apache2
    state: restarted
```

3. Playbook ì´ë¦„ì„ `playbook2.yml`ë¡œ ì§€ì •í•œ í›„ í•´ë‹¹ íŒŒì¼ ê°€ë¦¬í‚´

#### ğŸ“Œ Roleê³¼ Ansible Galaxy

- í˜„ì¬ê¹Œì§€ 4ê°œì˜ VMì„ ë°°í¬í–ˆìœ¼ë©° ì´ ì¤‘ 2ê°œì˜ VMì„ ì›¹ ì„œë²„ë¡œ êµ¬ì„±

- ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì™€ ë¡œë“œ ë°¸ëŸ°ì„œ ë˜ëŠ” í”„ë¡ì‹œ ë“± ì¢€ ë” êµ¬ì²´ì ì¸ ê¸°ëŠ¥ ì¡´ì¬

1. `ansible-galaxy`

- ê³µìœ  ë¦¬í¬ì§€í† ë¦¬ì—ì„œ Ansible Roleì„ ê´€ë¦¬

- `ansible-galaxy`ë¥¼ ì‚¬ìš©í•´ ì›¹ì„œë²„ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ë„£ì„ apache2ì˜ Role ìƒì„±

2. `ansible-galaxy init roles/apache2`

- í´ë” êµ¬ì¡° ìƒì„±

3. `tree`

4. ê¸°ì¡´ ì‘ì—…ê³¼ templateì„ ìƒˆ êµ¬ì¡°ì˜ ê´€ë ¨ í´ë”ë¡œ ì´ë™

- ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ìœ¼ë©´ íŒŒì¼ì„ ì‰½ê²Œ ì˜®ê¸¸ ìˆ˜ ìˆì§€ë§Œ, tasks/main.ymlì„ ë³€ê²½í•˜ì—¬ ì´ íŒŒì¼ì´ apache2_install.ymlì„ ê°€ë¦¬í‚¤ë„ë¡ í•´ì•¼í•¨

5. ìƒˆë¡œìš´ Roleì„ ì°¸ì¡°í•˜ë„ë¡ Playbook ë³€ê²½

```
- hosts: webservers
  become: yes
  vars:
    http_port: 8000
    https_port: 4443
    html_welcome_msg: "Hello 90DaysOfDevOps - Welcome to Day 66!"
  roles:
    - apache2
```

6. ìƒˆ Playbook ì´ë¦„ì¸ `ansible-playbook playbook3.yml`ë¡œ Playbook ë‹¤ì‹œ ì‹¤í–‰í•˜ë©´ deprecated ë°œìƒ

=> tasks/main.ymlì˜ include ì˜µì…˜ì„ import_tasksë¡œ ë³€ê²½

7. `ansible-galaxy`ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ Role ì¶”ê°€

- common: ëª¨ë“  ì„œë²„ìš© (`ansible-galaxy init roles/common`)

- nginx: ë¡œë“œë°¸ëŸ°ì„œìš© (`ansible-galaxy init roles/nginx`)

### Day67

âœ”ï¸ ì§€ê¸ˆê¹Œì§€ëŠ” apache2 Roleë§Œ ì‚¬ìš©í–ˆê³  ì›¹ ì„œë²„ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‘ë™í•˜ëŠ” playbook2.ymlì´ ì¡´ì¬

âœ”ï¸ `vagrant up loadbalancer`ë¥¼ ì‹¤í–‰í•˜ì—¬ ë¡œë“œ ë°¸ëŸ°ì„œ / í”„ë¡ì‹œë¡œ ì‚¬ìš©í•  ë‹¤ë¥¸ Ubuntu ì‹œìŠ¤í…œ ë“±ì¥

âœ”ï¸ hosts íŒŒì¼ì— ì´ ìƒˆ ì‹œìŠ¤í…œì„ ì´ë¯¸ ì •ì˜í–ˆì§€ë§Œ, ì‚¬ìš©í•  ìˆ˜ ìˆì„ ë•Œê¹Œì§€ ssh í‚¤ê°€ êµ¬ì„±ë˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ì‹œìŠ¤í…œì´ ê°€ë™ë˜ê³  ì¤€ë¹„ë˜ë©´ `ssh-copy-id loadbalancer` ì‹¤í–‰

#### ğŸ“Œ Common Role

- Common Role í´ë” êµ¬ì¡°ì˜ ì‘ì—… í´ë”ì—ëŠ” main.yml ì¡´ì¬ : ì´ YAMLì—ì„œ install_tools.yml íŒŒì¼ë¡œ ê°€ë¦¬ì¼œì•¼í•˜ë©° `- import_tasks: install_tools.yml` ì¶”ê°€

- ì´ì „ì—ëŠ” `include`ì˜€ìœ¼ë‚˜ ê³§ ì‚¬ìš©ë˜ì§€ ì•Šì„ ì˜ˆì •ì´ë¯€ë¡œ import_tasks ì‚¬ìš©

```
- name: "Install Common packages"
  apt: name={{ item }} state=latest
  with_items:
   - neofetch
   - tree
   - figlet
```

- playbookì—ì„œ ê° í˜¸ìŠ¤íŠ¸ ë¸”ë¡ì— ëŒ€í•œ Common Role ì¶”ê°€

```
- hosts: webservers
  become: yes
  vars:
    http_port: 8000
    https_port: 4443
    html_welcome_msg: "Hello 90DaysOfDevOps - Welcome to Day 66!"
  roles:
    - common
    - apache2
```

#### ğŸ“Œ Nginx Role

- ë¡œë“œë°¸ëŸ°ì„œ VMì— nginxë¥¼ ì„¤ì¹˜í•˜ê³  êµ¬ì„±

- playbookì— í˜¸ìŠ¤íŠ¸ ë¸”ë¡ ì¶”ê°€ => Common Roleê³¼ nginx Role í¬í•¨

```
- hosts: webservers
  become: yes
  vars:
    http_port: 8000
    https_port: 4443
    html_welcome_msg: "Hello 90DaysOfDevOps - Welcome to Day 66!"
  roles:
    - common
    - apache2

- hosts: proxy
  become: yes
  roles:
    - common
    - nginx
```

#### ğŸ“Œ ì—…ë°ì´íŠ¸ëœ playbook ì‹¤í–‰

1. `anible-playbook playbook4.yml`ë¡œ playbook4.yml ì‹¤í–‰

2. ì›¹ ì„œë²„ì™€ ë¡œë“œë°¸ëŸ°ì„œê°€ êµ¬ì„±ë˜ì—ˆìœ¼ë¯€ë¡œ ë¡œë“œë°¸ëŸ°ì„œì˜ IPì£¼ì†Œë¡œ ì´ë™í•  ìˆ˜ ìˆì–´ì•¼ í•¨

- ë¸Œë¼ìš°ì €ê°€ ì •ìƒì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ì§€ ì•Šì€ ê²½ìš° ì›¹ ì„œë²„ IP ì£¼ì†Œë¡œ ì—…ë°ì´íŠ¸

```
    upstream webservers {
        server 192.168.169.131:8000;
        server 192.168.169.132:8000;
    }

    server {
        listen 80;

        location / {
                proxy_pass http://webservers;
        }
    }
```

3. `ansible loadbalancer -m command -a neofetch`ë¡œ ì¼ë°˜ì ì¸ ë„êµ¬ ì„¤ì¹˜ í™•ì¸

### Day68

#### ğŸ“Œ Tag

- í™˜ê²½ì— ë§¤ìš° í¬ê³  ê¸´ playbookì´ ìˆëŠ” ê²½ìš° tagì„ í†µí•´ ì‘ì—…ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆìŒ

1. tag ì‚¬ìš©

```
- hosts: webservers
  become: yes
  vars:
    http_port: 8000
    https_port: 4443
    html_welcome_msg: "Hello 90DaysOfDevOps - Welcome to Day 66!"
  roles:
    - common
    - apache2
  tags: web

- hosts: proxy
  become: yes
  roles:
    - common
    - nginx
  tags: proxy
```

2. `ansible-playbook playbook5.yml --list-tags`ë¥¼ í†µí•´ í™•ì¸

- playbookì—ì„œ ì •ì˜í•œ Tagë¥¼ ë³´ì—¬ì¤Œ

3. `ansible-playbook playbook5.yml --tags proxy`ë¥¼ í†µí•´ í”„ë¡ì‹œ íƒ€ê²ŸíŒ…

âš¡ï¸ `tag: always`ëŠ” Tagê°€ ì§€ì •ëœ í•­ëª©ì´ ìˆìœ¼ë©´ ansible-playbook ëª…ë ¹ì„ ì‹¤í–‰í•  ë•Œ í•­ìƒ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥

âš¡ï¸ `ansible-playbook playbook5.yml --tags proxy,web`ì™€ ê°™ì´ ì—¬ëŸ¬ Tagë¥¼ í•¨ê»˜ ë¬¶ì„ ìˆ˜ë„ ìˆìŒ

#### ğŸ“Œ Variable

- Ansibleì—ëŠ” <span style="color:indianred">User created</span>ì™€ <span style="color:indianred">Ansible Facts</span> ë‘ ê°€ì§€ ìœ í˜•ì˜ variable ì¡´ì¬

#### ğŸ“Œ Ansible Facts

- playbookì„ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ "Gathering facts"ë¼ëŠ” ì •ì˜ë˜ì§€ ì•Šì€ ì‘ì—…ì´ ìˆëŠ”ë°, ì´ëŸ¬í•œ Variable ë˜ëŠ” factë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™í™” ì‘ì—… ìˆ˜í–‰ ê°€ëŠ¥

1. `ansible proxy -m setup`ì„ í†µí•´ JSON í˜•ì‹ì˜ ì¶œë ¥ ë³´ê¸°

- ëª…ë ¹ì— ëŒ€í•œ ëª¨ë“  ì¢…ë¥˜ì˜ ì •ë³´ ë³¼ ìˆ˜ ìˆìŒ : IP ì£¼ì†Œ, ì•„í‚¤í…ì²˜, ë°”ì´ì˜¤ìŠ¤ ë²„ì „

#### ğŸ“Œ User created

- User created Variableì€ ìš°ë¦¬ê°€ ì§ì ‘ ë§Œë“  Variable. playbookì˜ `vars:`ì— ì¡´ì¬í•˜ëŠ” 3ê°œì˜ Variable

```
- hosts: webservers
  become: yes
  vars:
    http_port: 8000
    https_port: 4443
    html_welcome_msg: "Hello 90DaysOfDevOps - Welcome to Day 68!"
  roles:
    - common
    - apache2
  tags: web

- hosts: proxy
  become: yes
  roles:
    - common
    - nginx
  tags: proxy
```

#### ğŸ“Œ Inventory íŒŒì¼

- ì§€ê¸ˆê¹Œì§€ëŠ” í˜¸ìŠ¤íŠ¸ë¥¼ ê²°ì •í•˜ê¸° ìœ„í•´ /etc/ansible í´ë”ì˜ ê¸°ë³¸ í˜¸ìŠ¤íŠ¸ íŒŒì¼ ì‚¬ìš©

- ì„œë²„ì™€ ë…¸ë“œì˜ ë‹¤ì–‘í•œ Inventoryì— ëŒ€í•´ ì—¬ëŸ¬ ê°œì˜ íŒŒì¼ ìƒì„± ê°€ëŠ¥ => `ansible-playbook -i dev playbook.yml` ì‚¬ìš©í•´ í˜¸ì¶œ

- í˜¸ìŠ¤íŠ¸ íŒŒì¼ ë‚´ì˜ Variable ì •ì˜í•œ í›„ ì¶œë ¥ ë˜ëŠ” playbookì˜ ë‹¤ë¥¸ ê³³ì—ì„œ í•´ë‹¹ variable í™œìš© ê°€ëŠ¥

#### ğŸ“Œ Database ì„œë²„ ë°°í¬

1. `vagrant up db01` > `ssh-copy-id db01`

- SSH í‚¤ë¥¼ ë³µì‚¬í•˜ì—¬ ì•¡ì„¸ìŠ¤

2. `ansible-galaxy init roles/mysql`

- "MySQL" ì´ë¼ëŠ” ìƒˆ Roleì— ëŒ€í•œ í´ë” êµ¬ì¡° ìƒì„±

```
- hosts: webservers
  become: yes
  roles:
    - common
    - apache2
  tags:
    web

- hosts: proxy
  become: yes
  roles:
    - common
    - nginx
  tags:
    proxy

- hosts: database
  become: yes
  roles:
    - common
    - mysql
  tags: database
```

3. ì½”ë“œ ì¶”ê°€

1) Handlers - main.yml

```
# handlers file for roles/mysql
- name: restart mysql
  service:
    name: mysql
    state: restarted
```

2. Tasks - install_mysql.yml, main.yml & setup_mysql.yml

install_mysql.yml
: MySQL ì„¤ì¹˜ ë° ì„œë¹„ìŠ¤ ì‹¤í–‰ í™•ì¸

```
- name: "Install Common packages"
  apt: name={{ item }} state=latest
  with_items:
   - python3-pip
   - mysql-client
   - python3-mysqldb
   - libmysqlclient-dev

- name: Ensure mysql-server is installed latest version
  apt: name=mysql-server state=latest

- name: Installing python module MySQL-python
  pip:
    name: PyMySQL

- name: Ensure mysql-server is running
  service:
    name: mysql
    state: started
```

main.yml
: íŒŒì¼ì—ì„œ ì‘ì—…ì„ ê°€ì ¸ì˜¤ë„ë¡ ì œì•ˆí•˜ëŠ” í¬ì¸í„° íŒŒì¼

```
# tasks file for roles/mysql
- import_tasks: install_mysql.yml
- import_tasks: setup_mysql.yml
```

setup_mysql.yml
: Databaseì™€ Database ì‚¬ìš©ì ìƒì„±

```
- name: Create my.cnf configuration file
  template: src=templates/my.cnf.j2 dest=/etc/mysql/conf.d/mysql.cnf
  notify: restart mysql

- name: Create database user with name 'devops' and password 'DevOps90' with all database privileges
  community.mysql.mysql_user:
    login_unix_socket: /var/run/mysqld/mysqld.sock
    login_user: "{{ mysql_user_name }}"
    login_password: "{{ mysql_user_password }}"
    name: "{{db_user}}"
    password: "{{db_pass}}"
    priv: '*.*:ALL'
    host: '%'
    state: present

- name: Create a new database with name '90daysofdevops'
  mysql_db:
    login_user: "{{ mysql_user_name }}"
    login_password: "{{ mysql_user_password }}"
    name: "{{ db_name }}"
    state: present
```

3. group_vars/all/common_variables.yml

```
http_port: 8000
https_port: 4443
html_welcome_msg: "Hello 90DaysOfDevOps - Welcome to Day 68!"

mysql_user_name: root
mysql_user_password: "vagrant"
db_user: devops
db_pass: DevOps90
db_name: 90DaysOfDevOps
```

4. template/my.cnf.j2

```
[mysql]
bind-address = 0.0.0.0
```

#### ğŸ“Œ playbook ì‹¤í–‰

1. `ansible-playbook playbook7.yml`

=> ëª¨ë“  ì‘ì—…ì´ í¬í•¨ëœ playbook ì‹¤í–‰

2. `ansible-playbook playbook7.yml --tags database`

=> Database ê·¸ë£¹ì— ë°°í¬í•˜ì—¬ ìƒˆ êµ¬ì„± íŒŒì¼ë§Œ ì‹¤í–‰í•˜ë„ë¡ ì„ íƒ ê°€ëŠ¥

3. `ssh db01`ì„ í†µí•´ db01 ì„œë²„ì—ì„œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸

4. `sudo /usr/bin/mysql -u root -p`ë¥¼ í†µí•´ MySQLì— ì—°ê²°

5. `select user, host from mysql.user;`ë¡œ DevOpsë¼ëŠ” ì‚¬ìš©ìê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸

6. `SHOW DATABASES;`ë¡œ ìƒì„±ëœ DB í™•ì¸

### Day69

#### ğŸ“Œ ê¸°íƒ€ ëª¨ë“  Ansible - ìë™í™” ì»¨íŠ¸ë¡¤ëŸ¬(íƒ€ì›Œ), AWX, Vault

1. Ansible ìë™í™” ì»¨íŠ¸ë¡¤ëŸ¬ + AWX

- AWX : ì‚¬ìš©ì í™˜ê²½ ë‚´ì—ì„œ Ansible í”„ë¡œì íŠ¸ë¥¼ ë” ì˜ ì œì–´í•  ìˆ˜ ìˆë„ë¡ ì§€ì›

- Ansible ìë™í™” ì»¨íŠ¸ë¡¤ëŸ¬ : Ansible ìë™í™” í”Œë«í¼ì˜ ì»¨íŠ¸ë¡¤ í”Œë ˆì¸

2. Ansible Vault

3. Ansible Galaxy

4. Ansible í…ŒìŠ¤íŠ¸
